
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>运维日常工作流程 - null</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    
    <meta name="description" content="主要工作：【一】线上工作：

国内海外游戏服务器更新
监控报警维护处理
准备游戏新区服
根据运营需求进行合服

【二】测试环境工作：

内网AWS部署测试镜像服供QA使用
内网测试服务器部署
为开发,"> 
    <meta name="author" content="zhaodan"> 
    
    <link rel="icon" href="/img/chiguaxiaoji.jpg"> 
    
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

    
<link rel="stylesheet" href="/css/diaspora.css">

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
<meta name="generator" content="Hexo 4.2.0"></head>

<body class="loading">
    <span id="config-title" style="display:none"></span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="http://zhaodan.online"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">运维日常工作流程</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">运维日常工作流程</h1>
        <div class="stuff">
            <span>十月 11, 2017</span>
            

        </div>
        <div class="content markdown">
            <p>主要工作：<br>【一】线上工作：</p>
<ol>
<li>国内海外游戏服务器更新</li>
<li>监控报警维护处理</li>
<li>准备游戏新区服</li>
<li>根据运营需求进行合服</li>
</ol>
<p>【二】测试环境工作：</p>
<ol>
<li>内网AWS部署测试镜像服供QA使用</li>
<li>内网测试服务器部署</li>
<li>为开发人员部署其他测试环境</li>
</ol>
<p>【三】配合运营的工作：</p>
<ol>
<li>作弊日志上传内网FTP</li>
<li>海外反作弊的发送</li>
<li>userinfo的Log上传至FTP</li>
<li>根据运营要求生成激活码</li>
</ol>
<p>【四】内网其他工作：</p>
<ol>
<li>IT相关</li>
</ol>
<hr>
<p>####准备游戏新区服流程<br>#####操作流程CheckList</p>
<ul>
<li><input disabled="" type="checkbox"> 检查服务器压力负载</li>
<li><input disabled="" type="checkbox"> 检查redis内存大小</li>
<li><input disabled="" type="checkbox"> 检查新服与目标机器IP是否一致</li>
<li><input disabled="" type="checkbox"> 检查fact，dns是否正确</li>
<li><input disabled="" type="checkbox"> 检查etcd是否有改动</li>
<li><input disabled="" type="checkbox"> 检查目标机器端口是否开放</li>
<li><input disabled="" type="checkbox"> 检查当前gamex版本信息</li>
<li><input disabled="" type="checkbox"> 检查是否有热更</li>
<li><input disabled="" type="checkbox"> 检查启动时间</li>
</ul>
<p>#####部署操作</p>
<ul>
<li><input disabled="" type="checkbox"> 查看playbook中gamex信息，确定新服目标机器</li>
<li><input disabled="" type="checkbox"> 查看redis信息，确定新服目标空闲DB（ redis-cli -h IP -a PASSWD info ）</li>
<li><input disabled="" type="checkbox"> 本地修改playbook配置信息，增加新服gamex，etcd和csv的配置信息并提交git</li>
<li><input disabled="" type="checkbox"> jenkins上注册sn码</li>
<li><input disabled="" type="checkbox"> jenkins上注册etcd</li>
<li><input disabled="" type="checkbox"> 确定好目标机器IP，本地注册ansible的fact</li>
<li><input disabled="" type="checkbox"> jenkins上单服部署gamex</li>
<li><input disabled="" type="checkbox"> 部署redisstorage-userinfo</li>
<li><input disabled="" type="checkbox"> 重启GMtools</li>
<li><input disabled="" type="checkbox"> 验证新服是否注册成功，查看新服目标机器配置信息</li>
<li><input disabled="" type="checkbox"> 登陆GMtools检查新服信息</li>
</ul>
<hr>
<p>####线上合服流程<br>#####操作流程CheckList</p>
<ul>
<li><input disabled="" type="checkbox"> 检查数据库备份是否正常</li>
<li><input disabled="" type="checkbox"> 检查playbook中gamex配置信息是否正确</li>
<li><input disabled="" type="checkbox"> 检查机器fact，dns是否正确</li>
<li><input disabled="" type="checkbox"> 检查redis内存</li>
<li><input disabled="" type="checkbox"> 检查etcd是否有改动</li>
<li><input disabled="" type="checkbox"> 检查当前gamex版本信息</li>
</ul>
<p>#####合服准备</p>
<ul>
<li><input disabled="" type="checkbox"> 统计目标区服的详细信息，可在本地执行脚本查看（ python get_redis_used.py ）</li>
<li><input disabled="" type="checkbox"> 登陆跳板机查看redis db信息，规划合服后的redis db （ python get_redis_used.py ）</li>
<li><input disabled="" type="checkbox"> 本地修改目标区服的Etcd配置并删除被合区服的gamex</li>
</ul>
<p>#####合服操作</p>
<ul>
<li><input disabled="" type="checkbox"> 停服操作</li>
<li><input disabled="" type="checkbox"> Jenkins上手动执行上传日志到S3的3个job</li>
<li><input disabled="" type="checkbox"> 登陆跳板机，在all_shard_info.txt中写入统计的目标区服信息</li>
<li><input disabled="" type="checkbox"> 在merge_conf.txt中写入规划好的配置信息</li>
<li><input disabled="" type="checkbox"> 执行合服脚本，sh create_merge_conf.sh 创建merge.toml文件，同时再次检查merge.tom的配置是否与规划的一致</li>
<li><input disabled="" type="checkbox"> 记录合服脚本输出并归档到印象笔记</li>
<li><input disabled="" type="checkbox"> jenkins上删除目标区服对应的服务及配置</li>
<li><input disabled="" type="checkbox"> git提交修改代码</li>
<li><input disabled="" type="checkbox"> jenkins注册对应大区Etcd</li>
<li><input disabled="" type="checkbox"> jenkins选择对应大区部署gamex</li>
<li><input disabled="" type="checkbox"> jenkins选择对应大区部署redisstorage-userinfo</li>
<li><input disabled="" type="checkbox"> jenkins上传充值每小时log到S3</li>
<li><input disabled="" type="checkbox"> 登陆跳板机，连接合服完毕的机器，查看配置是否正确</li>
<li><input disabled="" type="checkbox"> 检查合服后的redis db的key值是否正常</li>
<li><input disabled="" type="checkbox"> QA测试完毕没有任何问题后，清理被合服区服的原db</li>
</ul>
<hr>
<h4 id="极无双线上部署流程规范"><a href="#极无双线上部署流程规范" class="headerlink" title="极无双线上部署流程规范"></a>极无双线上部署流程规范</h4><h4 id="上线CheckList"><a href="#上线CheckList" class="headerlink" title="上线CheckList"></a>上线CheckList</h4><ul>
<li><input disabled="" type="checkbox"> 是否有运维部署操作（服务器磁盘大小升级、服务器cpu升级、服务器内存升级、数据库机器进行升级、其它服务进行升级）<br>如果有运维部署操作，需要对应的操作流程<br>所有的操作大流程基本上是<br>首先和运营确认本次更新时间、运维操作预估时间，两者时间是否有较大的出入<br>根据对应的服务器操作流程进行服务器的升级和降级，必须保障数据的完整<br>如果对数据库操作，先备份   </li>
</ul>
<ul>
<li><input disabled="" type="checkbox"> <p>确认是否有提前停服需求–&gt;【运营、策划】<br>如果有停服需要，如何做，检查停服脚本的大区？<br>停服之后，如果删除这个脚本或者关闭这个脚本（避免出现忘记修改脚本，导致多次停服）</p>
</li>
<li><input disabled="" type="checkbox"> <p>检查确认是否存在热更–&gt;【服务器】<br>如何去掉热更</p>
</li>
<li><input disabled="" type="checkbox"> <p>检查确认是否存在敏感数据操作–&gt;【服务器】<br>敏感数据是否测试过；；；；</p>
</li>
<li><input disabled="" type="checkbox"> <p>检查确认更新服务版本信息 –&gt;【邮件】</p>
</li>
<li><input disabled="" type="checkbox"> <p>记录版本信息到印象笔记并截图至服务器群组确认（记录信息命名格式：版本+时间）</p>
</li>
<li><input disabled="" type="checkbox"> <p>确认部署所需版本包已成功传至对应S3</p>
</li>
<li><input disabled="" type="checkbox"> <p>确认维护公告是否生效–&gt;【运维中心群组】</p>
</li>
<li><input disabled="" type="checkbox"> <p>开始更新维护并同步操作信息至群组 –&gt;【运维中心群组】<br>更新gamex、auth等操作需要注意的地方，比如选择大区，</p>
</li>
</ul>
<ul>
<li><input disabled="" type="checkbox"> <p>检查Ansible部署输出是否有Err日志</p>
</li>
<li><input disabled="" type="checkbox"> <p>检查服务器进程是否Running<br>上机器检查、grafana</p>
</li>
<li><input disabled="" type="checkbox"> <p>是否需要重新部署redisstorage-userinfo<br>存在数据库操作的情况，都需要重新部署整个大区的redisstorage-userinfo<br>gamex增加、减少等</p>
</li>
<li><input disabled="" type="checkbox"> <p>是否需要重启GMtools<br>存在数据库操作的情况，都需要重新部署整个大区的redisstorage-userinfo<br>gamex增加、减少等</p>
</li>
<li><input disabled="" type="checkbox"> <p>检查GM工具区服显示是否为可进<br>顺便检查下   所有的gamex 是否玩家可进 </p>
</li>
<li><input disabled="" type="checkbox"> <p>检查监控报警是否正常</p>
</li>
<li><input disabled="" type="checkbox"> <p>检查其它服务是否正常，eg     gamex、auth、crossservice、chat等</p>
</li>
<li><input disabled="" type="checkbox"> <p>通知QA进行测试</p>
</li>
<li><input disabled="" type="checkbox"> <p>维护完成后关注监控是否存在异常，服务器看看log</p>
</li>
</ul>
<h4 id="上线故障排除"><a href="#上线故障排除" class="headerlink" title="上线故障排除"></a>上线故障排除</h4><ul>
<li>1.）Jenkins部署未找到版本包<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#排错思路：查看确认内网Jenkins编译名称--&gt;Jenkins部署匹配名称是否一致--&gt;S3对应bucket是否存在该包</span><br><span class="hljs-comment">#一般解决：编辑对应jenkins任务配置选项，查看filename变量选项，如下行</span><br>s3://yingzhuo-gamex/gamexback/gmtools<span class="hljs-string">'.execute</span><br></code></pre></td></tr></table></figure></li>
<li>2.）Jenkins部署变量报错<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#排错思路：是否存在新添加Etcd key值需提交--&gt; 是否注册etcd --&gt; 打包配置模板变量名称与注册etcd变量名称是否一致</span><br><span class="hljs-comment">#一般解决：重新注册etcd</span><br></code></pre></td></tr></table></figure></li>
<li>3.）公告服务可用性快速验证<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://<span class="hljs-variable">$ip</span>:<span class="hljs-variable">$port</span>/notice/v1/getnotice?gid=<span class="hljs-variable">$gid</span>&amp;version=<span class="hljs-variable">$version</span><br><span class="hljs-comment"># a. 更改Notice的外网IP及端口，以及gid 和version信息，通过http方法进行访问，正常会返回公告信息</span><br><span class="hljs-comment"># b. 需注意现版本对外端口需要开放两个，port1 及 port2</span><br></code></pre></td></tr></table></figure></li>
</ul>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
		data-enable='true'
        data-ae='true'
        data-ci=''
        data-cs=''
        data-r=''
        data-o=''
        data-a=''
        data-d='false'
    >查看评论</div>


    </div>
    
        <div class='side'>
			<ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#极无双线上部署流程规范"><span class="toc-number">1.</span> <span class="toc-text">极无双线上部署流程规范</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#上线CheckList"><span class="toc-number">2.</span> <span class="toc-text">上线CheckList</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#上线故障排除"><span class="toc-number">3.</span> <span class="toc-text">上线故障排除</span></a></li></ol>	
        </div>
    
</div>


    </div>
</div>
</body>

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
