<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>
        
    </title>
    
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-reply replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            MySQL授权 &amp; MySQL备份
        </p>
        <hr>
    </div>
    <div class="post-content">
        <p>记大数据MySQL备份</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[root@ip data]# cat mysql_back.sh<br><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-attribute">user</span>=user<br><span class="hljs-attribute">pass</span>=pass<br><span class="hljs-attribute">table1</span>=table1<br><span class="hljs-attribute">table2</span>=table2<br><span class="hljs-attribute">date</span>=`date +%Y%m%d --date <span class="hljs-string">"-1 days"</span>`<br><br>mysqldump  -u<span class="hljs-variable">$user</span> -p<span class="hljs-variable">$pass</span> <span class="hljs-attribute">--default-character-set</span>=utf8 <span class="hljs-attribute">--comments</span>=<span class="hljs-literal">FALSE</span> --tables <span class="hljs-attribute">--no-create-info</span>=<span class="hljs-literal">FALSE</span> <span class="hljs-attribute">--add-drop-table</span>=<span class="hljs-literal">TRUE</span> <span class="hljs-attribute">--no-data</span>=<span class="hljs-literal">FALSE</span> <span class="hljs-variable">$table1</span> | sed <span class="hljs-string">'s/AUTO_INCREMENT=[0-9]*\s//g'</span> &gt;/data/backup_CN/<span class="hljs-variable">$table1</span><span class="hljs-variable">$date</span>.sql<br>mysqldump  -u<span class="hljs-variable">$user</span> -p<span class="hljs-variable">$pass</span> <span class="hljs-attribute">--default-character-set</span>=utf8 <span class="hljs-attribute">--comments</span>=<span class="hljs-literal">FALSE</span> --tables <span class="hljs-attribute">--no-create-info</span>=<span class="hljs-literal">FALSE</span> <span class="hljs-attribute">--add-drop-table</span>=<span class="hljs-literal">TRUE</span> <span class="hljs-attribute">--no-data</span>=<span class="hljs-literal">FALSE</span> <span class="hljs-variable">$table2</span> | sed <span class="hljs-string">'s/AUTO_INCREMENT=[0-9]*\s//g'</span> &gt;/data/backup_JP/<span class="hljs-variable">$table2</span><span class="hljs-variable">$date</span>.sql<br><span class="hljs-builtin-name">find</span> backup_CN/ -name <span class="hljs-string">"*.sql"</span> -type f -mtime +5 -exec rm &#123;&#125; \; &gt; /dev/<span class="hljs-literal">null</span> 2&gt;&amp;1<br><span class="hljs-builtin-name">find</span> backup_JP/ -name <span class="hljs-string">"*.sql"</span> -type f -mtime +5 -exec rm &#123;&#125; \; &gt; /dev/<span class="hljs-literal">null</span> 2&gt;&amp;1<br></code></pre></td></tr></table></figure>




<p>mysql5.7 改root密码授权</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># safe_mysqld <span class="hljs-comment">--skip-grant-tables --user=root &amp;</span><br>mysql&gt; <span class="hljs-keyword">update</span> mysql.<span class="hljs-keyword">user</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">password</span>=<span class="hljs-keyword">PASSWORD</span>(<span class="hljs-string">'新密码'</span>) <span class="hljs-keyword">where</span> <span class="hljs-keyword">User</span>=<span class="hljs-string">'root'</span>; <br>mysql&gt; flush <span class="hljs-keyword">privileges</span>;<br></code></pre></td></tr></table></figure>

<p>创建一个用户叫test1 并授权</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">mysql&gt; grant <span class="hljs-keyword">select</span>,<span class="hljs-keyword">insert</span>,<span class="hljs-keyword">update</span>,<span class="hljs-keyword">delete</span> <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> test1@”%” Identified <span class="hljs-keyword">by</span> “abc”;<br>mysql&gt; FLUSH PRIVILEGES;<br><br>查看授权表<br>mysql&gt; <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.<span class="hljs-keyword">user</span>;<br><br>取消授权<br>mysql&gt; revoke all privileges on *.* from test1@"%”;<br><br>删除用户<br>mysql&gt; use mysql<br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>mysql&gt; <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span> - <span class="hljs-string">"test1"</span> <span class="hljs-keyword">and</span> host = <span class="hljs-string">"public ip"</span>;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span> - <span class="hljs-string">"test1"</span> <span class="hljs-keyword">and</span> host = <span class="hljs-string">"private ip"</span>;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span> - <span class="hljs-string">"test1"</span> <span class="hljs-keyword">and</span> host = <span class="hljs-string">"localhost"</span>;<br>Query OK, 0 rows affected, 3 warnings (0.00 sec)<br><br>mysql&gt; <span class="hljs-keyword">drop</span> <span class="hljs-keyword">user</span> test1@<span class="hljs-string">'%'</span>;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt;  flush privileges;<br>Query OK, 0 rows affected (0.00 sec<br></code></pre></td></tr></table></figure>


<p>记一次mysql授权，允许远程连接</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mysql&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span> <span class="hljs-keyword">on</span> *.*  <span class="hljs-keyword">to</span> <span class="hljs-string">'root'</span>@localhost identified <span class="hljs-keyword">by</span> <span class="hljs-string">'123456'</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)<br><br>mysql&gt; <span class="hljs-keyword">update</span> mysql.<span class="hljs-keyword">user</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">password</span>=<span class="hljs-keyword">password</span>(<span class="hljs-string">'123456'</span>) <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span>=<span class="hljs-string">'root'</span>;<br>Query OK, <span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)<br><span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">4</span>  Changed: <span class="hljs-number">3</span>  Warnings: <span class="hljs-number">0</span><br><br>mysql&gt; flush <span class="hljs-keyword">privileges</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql&gt; \q<br>Bye<br><br>[root@ip ops_user]# /etc/init.d/mysqld <span class="hljs-keyword">restart</span><br>Stopping mysqld:                                           [  OK  ]<br>Starting mysqld:                                           [  OK  ]<br><br>[root@ip ops_user]# mysql -uroot -p123456<br>Welcome <span class="hljs-keyword">to</span> the MySQL monitor.  Commands <span class="hljs-keyword">end</span> <span class="hljs-keyword">with</span> ; <span class="hljs-keyword">or</span> \g.<br><br>mysql&gt; <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">PRIVILEGES</span> <span class="hljs-keyword">ON</span> *.* <span class="hljs-keyword">TO</span> root@"%" IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'123456'</span>  <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">OPTION</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>#####<br><br>远程连接mysql<br><br># /usr/<span class="hljs-keyword">local</span>/mysql/bin/mysql  -h【IP】 -uroot  -p123456<br><br>#####################<br>实现远程连接(授权法)<br>mysql&gt; use mysql;<br>mysql&gt; <span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">privileges</span>  <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> root@<span class="hljs-string">'%'</span> identified <span class="hljs-keyword">by</span> "password”;<br>mysql&gt; flush privileges;<br>mysql&gt; select host,user,password from user;<br><br>实现远程连接（改表法）<br>mysql&gt; use mysql;<br>mysql&gt; update user set host = '%' where user = 'root';<br></code></pre></td></tr></table></figure>

<p>mysql备份单独一张表</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"># mysqldump  -uroot -p123456 --<span class="hljs-keyword">default</span>-character-<span class="hljs-keyword">set</span>=utf8 --comments=<span class="hljs-keyword">FALSE</span> --tables --no-<span class="hljs-keyword">create</span>-info=<span class="hljs-keyword">FALSE</span> --<span class="hljs-keyword">add</span>-drop-table=<span class="hljs-keyword">TRUE</span> --no-data=<span class="hljs-keyword">FALSE</span> test | sed <span class="hljs-string">'s/AUTO_INCREMENT=[0-9]*\s//g'</span> &gt;test_20180626.sql<br></code></pre></td></tr></table></figure>
<p>备份导入MySQL</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">mysql&gt;</span><span class="bash"> use <span class="hljs-built_in">test</span>;</span><br><span class="hljs-meta">mysql&gt;</span><span class="bash"> <span class="hljs-built_in">source</span> /home/<span class="hljs-built_in">test</span>/0101_0630_up_subjects.sql</span><br></code></pre></td></tr></table></figure>


    </div>

    
        <hr class="fhr">
        <div id="vcomments"></div>
    
</div>
    <div class="footer" id="footer">
    <p>Copyright © 2020 <a class="flink" href="https://hexo.io" target="_blank" rel="noopener">Hexo</a>-<a class="flink" href="https://github.com/sanjinhub/hexo-theme-geek" target="_blank" rel="noopener">Geek</a>.
        <label class="el-switch el-switch-green el-switch-sm" style="vertical-align: sub;">
            <input type="checkbox" name="switch" id="update_style">
            <span class="el-switch-style"></span>
        </label>
<!--         <script type="text/javascript">
        var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
        document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
        </script> -->
    </p>
</div>
<input type="hidden" id="web_style" value="black">
<input type="hidden" id="valine_appid" value="nmcd4VgylfORjevWz6UEoat3-9Nh9j0Va">
<input type="hidden" id="valine_appKey" value="wyWWI1qMf6w1mv1KpT1D0HeC">

<script src="/libs/jquery.min.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>

<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>

<script src="/js/js.js"></script>

<style type="text/css">
.v * {
    color: #698fca;
}

.v .vlist .vcard .vhead .vsys {
    color: #3a3e4a;
}

.v .vlist .vcard .vh .vmeta .vat {
    color: #638fd5;
}

.v .vlist .vcard .vhead .vnick {
    color: #6ba1ff;
}

.v a {
    color: #8696b1;
}

.v .vlist .vcard .vhead .vnick:hover {
    color: #669bfc;
}
</style>
</body>

</html>