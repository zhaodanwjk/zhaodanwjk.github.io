<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  

  

  
    <meta name="author" content="zhaodan">
  

  
    <meta name="copyright" content="zhaodan">
  

  

  <title>harborV1.10.1 基于复制策略同步测试 | </title>

  

  
    <link rel="icon" href="/favicon.ico">
  

  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
    <link href="https://cdn.bootcss.com/highlight.js/9.15.6/styles/monokai.min.css" rel="stylesheet">
  

  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>
<body>
  <div class="root-container">
    <!-- navbar -->
<nav class="navbar">
  <div class="navbar-content">
    <!-- logo -->
    <div class="navbar-logo">
      <a href="/">
        
          
        
      </a>
    </div>
    <!-- link -->
    <div class="navbar-link">
      <div class="navbar-btn">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <ul class="navbar-list">
        
          <li class="navbar-list-item"><a href="/">主页</a></li>
        
          <li class="navbar-list-item"><a href="/about">关于</a></li>
        
          <li class="navbar-list-item"><a href="/archives">归档</a></li>
        
          <li class="navbar-list-item"><a href="/messages">留言板</a></li>
        
      </ul>
    </div>
  </div>
</nav>

    
<!-- header container -->
<header class="header-container post">

  
  

  
  

  
  

  
  

  
  
    <div class="header-content">
      <div class="post-image" style="background-image: url(images/dengdeng.jpg)"></div>
      <div class="post-text">
        <div class="type-wrap">
          
        </div>
        <h1 class="title-wrap">harborV1.10.1 基于复制策略同步测试</h1>
        <h2 class="title-sub-wrap">
          <strong>zhaodan</strong>
          <span>发布于</span>
          
  <a href="javascript:;" class="article-date">
    <time datetime="2020-03-05T16:00:00.000Z" itemprop="datePublished">2020-03-06</time>
  </a>

        </h2>
      </div>
    </div>
  

  
  

  </header>

    <!-- 文章 -->

<!-- 文章内容 -->

<div class="body-container">
  <article class="content-container article-container">
    <div class="article-content">
      
      

      <section class="article-entry">
        <p>复制原理： harbor的复制案例是基于harbor的registry复制策略进行设置的<br>双主复制：其实就是复用主从同步实现两个harbor节点之间的双向同步<br>测试环境：使用docker部署启动，两个节点互为主从进行同步</p>
<p>测试过程：<br>CA认证</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[root@VM_0_6_centos ~]# mkdir /data/ssl<br>[root@VM_0_6_centos ~]# cd /data/ssl/<br>[root@VM_0_6_centos ssl]# yum install openssl<br>已加载插件：fastestmirror, langpacks<br>Loading<span class="hljs-built_in"> mirror </span>speeds <span class="hljs-keyword">from</span> cached hostfile<br>epel                                                                      | 5.3 kB  00:00:00<br>extras                                                                    | 2.9 kB  00:00:00<br>os                                                                        | 3.6 kB  00:00:00<br>updates                                                                   | 2.9 kB  00:00:00<br>(1/2): epel/7/x86_64/updateinfo                                           | 1.0 MB  00:00:00<br>(2/2): epel/7/x86_64/primary_db                                           | 6.7 MB  00:00:00<br>软件包 1:openssl-1.0.2k-19.el7.x86_64 已安装并且是最新版本<br>无须任何处理<br>[root@VM_0_6_centos ssl]# openssl req -newkey rsa:4096 -nodes -sha256 -keyout ca.key -x509 -days 365 -out ca.crt<br>Generating a 4096 bit RSA private key<br><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>.++<br><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>.++<br>writing new private key <span class="hljs-keyword">to</span> <span class="hljs-string">'ca.key'</span><br>-----<br>You are about <span class="hljs-keyword">to</span> be asked <span class="hljs-keyword">to</span> enter information that will be incorporated<br>into your certificate request.<br>What you are about <span class="hljs-keyword">to</span> enter is what is called a Distinguished Name <span class="hljs-keyword">or</span> a DN.<br>There are quite a few fields but you can leave some blank<br><span class="hljs-keyword">For</span> some fields there will be a<span class="hljs-built_in"> default </span>value,<br><span class="hljs-keyword">If</span> you enter <span class="hljs-string">'.'</span>, the field will be left blank.<br>-----<br>Country Name (2 letter code) [XX]:CN<br>State <span class="hljs-keyword">or</span> Province Name (full name) []:Shenzhen<br>Locality Name (eg, city) [Default City]:Shenzhen<br>Organization Name (eg, company) [Default Company Ltd]:lumitest<br>Organizational Unit Name (eg, section) []:lumitest<br>Common Name (eg, your name <span class="hljs-keyword">or</span> your server<span class="hljs-string">'s hostname) []:www.lumitest.com</span><br><span class="hljs-string">Email Address []:</span><br><span class="hljs-string">[root@VM_0_6_centos ssl]# ls</span><br><span class="hljs-string">ca.crt  ca.key</span><br><span class="hljs-string">[root@VM_0_6_centos ssl]# openssl req -newkey rsa:4096 -nodes -sha256 -keyout www.lumitest.com.key -out www.lumitest.com.csr</span><br><span class="hljs-string">Generating a 4096 bit RSA private key</span><br><span class="hljs-string">.........++</span><br><span class="hljs-string">.....................................................++</span><br><span class="hljs-string">writing new private key to '</span>www.lumitest.com.key<span class="hljs-string">'</span><br><span class="hljs-string">-----</span><br><span class="hljs-string">You are about to be asked to enter information that will be incorporated</span><br><span class="hljs-string">into your certificate request.</span><br><span class="hljs-string">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="hljs-string">There are quite a few fields but you can leave some blank</span><br><span class="hljs-string">For some fields there will be a default value,</span><br><span class="hljs-string">If you enter '</span>.<span class="hljs-string">', the field will be left blank.</span><br><span class="hljs-string">-----</span><br><span class="hljs-string">Country Name (2 letter code) [XX]:CN</span><br><span class="hljs-string">State or Province Name (full name) []:Shenzhen</span><br><span class="hljs-string">Locality Name (eg, city) [Default City]:Shenzhen</span><br><span class="hljs-string">Organization Name (eg, company) [Default Company Ltd]:lumitest</span><br><span class="hljs-string">Organizational Unit Name (eg, section) []:lumitest</span><br><span class="hljs-string">Common Name (eg, your name or your server'</span>s hostname) []:www.lumitest.com<br>Email<span class="hljs-built_in"> Address </span>[]:<br><br>Please enter the following <span class="hljs-string">'extra'</span> attributes<br><span class="hljs-keyword">to</span> be sent with your certificate request<br>A challenge password []:<br>An optional company name []:<br>[root@VM_0_6_centos ssl]# ls<br>ca.crt  ca.key  www.lumitest.com.csr  www.lumitest.com.key<br>[root@VM_0_6_centos ssl]# openssl x509 -req -days 365 -in www.lumitest.com.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out www.lumitest.com.crt<br>Signature ok<br><span class="hljs-attribute">subject</span>=/C=CN/ST=Shenzhen/L=Shenzhen/O=lumitest/OU=lumitest/CN=www.lumitest.com<br>Getting CA Private Key<br>[root@VM_0_6_centos ssl]# ls<br>ca.crt  ca.key  ca.srl  www.lumitest.com.crt  www.lumitest.com.csr  www.lumitest.com.key<br>[root@VM_0_6_centos ssl]# ls /etc/pki/ca-trust/source/anchors/<br>[root@VM_0_6_centos ssl]# cp www.lumitest.com.crt /etc/pki/ca-trust/source/anchors/<br>[root@VM_0_6_centos ssl]# update<br>update-alternatives   updatedb              update-pciids<br>update-ca-trust       update-mime-database<br>[root@VM_0_6_centos ssl]# update-ca-trust enable<br>[root@VM_0_6_centos ssl]# update-ca-trust extract<br><br>[root@VM_0_6_centos ssl]# mkdir /etc/ssl/harbor<br>[root@VM_0_6_centos ssl]# cp www.lumitest.com.crt www.lumitest.com.key /etc/ssl/harbor/<br>[root@VM_0_6_centos ssl]# ls /etc/ssl/harbor/<br>www.lumitest.com.crt  www.lumitest.com.key<br></code></pre></td></tr></table></figure>
<p>查看环境</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">[<span class="hljs-symbol">root@</span>VM_0_6_centos ssl]# sestatus<br>SELinux status:                 disabled<br>[<span class="hljs-symbol">root@</span>VM_0_6_centos ssl]# systemctl status firewalld<br>● firewalld.service - firewalld - dynamic firewall daemon<br>   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled)<br>   Active: inactive (dead)<br>     Docs: man:firewalld(<span class="hljs-number">1</span>)<br><br>[<span class="hljs-symbol">root@</span>VM_0_6_centos harbor]# docker --version<br>Docker version <span class="hljs-number">1.13</span><span class="hljs-number">.1</span>, build <span class="hljs-number">4</span>ef4b30/<span class="hljs-number">1.13</span><span class="hljs-number">.1</span><br>[<span class="hljs-symbol">root@</span>VM_0_6_centos harbor]# yum remove docker \<br>                   docker-client \<br>                   docker-client-latest \<br>                   docker-common \<br>                   docker-latest \<br>                   docker-latest-logrotate \<br>                   docker-logrotate \<br>                   docker-engine<br>已加载插件：fastestmirror, langpacks<br>参数 docker-client-latest 没有匹配<br>参数 docker-latest 没有匹配<br>参数 docker-latest-logrotate 没有匹配<br>参数 docker-logrotate 没有匹配<br>参数 docker-engine 没有匹配<br>正在解决依赖关系<br>--&gt; 正在检查事务<br>---&gt; 软件包 docker.x86_64<span class="hljs-number">.2</span><span class="hljs-number">.1</span><span class="hljs-number">.13</span><span class="hljs-number">.1</span><span class="hljs-number">-108.</span>git4ef4b30.el7.centos 将被 删除<br>---&gt; 软件包 docker-client.x86_64<span class="hljs-number">.2</span><span class="hljs-number">.1</span><span class="hljs-number">.13</span><span class="hljs-number">.1</span><span class="hljs-number">-108.</span>git4ef4b30.el7.centos 将被 删除<br>---&gt; 软件包 docker-common.x86_64<span class="hljs-number">.2</span><span class="hljs-number">.1</span><span class="hljs-number">.13</span><span class="hljs-number">.1</span><span class="hljs-number">-108.</span>git4ef4b30.el7.centos 将被 删除<br>--&gt; 解决依赖关系完成<br><br>依赖关系解决<br><br>=================================================================================================<br> Package             架构         版本                                       源             大小<br>=================================================================================================<br>正在删除:<br> docker              x86_64       <span class="hljs-number">2</span>:<span class="hljs-number">1.13</span><span class="hljs-number">.1</span><span class="hljs-number">-108.</span>git4ef4b30.el7.centos         @extras        <span class="hljs-number">65</span> M<br> docker-client       x86_64       <span class="hljs-number">2</span>:<span class="hljs-number">1.13</span><span class="hljs-number">.1</span><span class="hljs-number">-108.</span>git4ef4b30.el7.centos         @extras        <span class="hljs-number">13</span> M<br> docker-common       x86_64       <span class="hljs-number">2</span>:<span class="hljs-number">1.13</span><span class="hljs-number">.1</span><span class="hljs-number">-108.</span>git4ef4b30.el7.centos         @extras       <span class="hljs-number">4.4</span> k<br><br>事务概要<br>=================================================================================================<br>移除  <span class="hljs-number">3</span> 软件包<br><br>安装大小：<span class="hljs-number">77</span> M<br>是否继续？[y/N]：y<br>Downloading packages:<br>Running transaction check<br>Running transaction test<br>Transaction test succeeded<br>Running transaction<br>  正在删除    : <span class="hljs-number">2</span>:docker<span class="hljs-number">-1.13</span><span class="hljs-number">.1</span><span class="hljs-number">-108.</span>git4ef4b30.el7.centos.x86_64                             <span class="hljs-number">1</span>/<span class="hljs-number">3</span><br>警告：/etc/sysconfig/docker-storage 已另存为 /etc/sysconfig/docker-storage.rpmsave<br>  正在删除    : <span class="hljs-number">2</span>:docker-client<span class="hljs-number">-1.13</span><span class="hljs-number">.1</span><span class="hljs-number">-108.</span>git4ef4b30.el7.centos.x86_64                      <span class="hljs-number">2</span>/<span class="hljs-number">3</span><br>  正在删除    : <span class="hljs-number">2</span>:docker-common<span class="hljs-number">-1.13</span><span class="hljs-number">.1</span><span class="hljs-number">-108.</span>git4ef4b30.el7.centos.x86_64                      <span class="hljs-number">3</span>/<span class="hljs-number">3</span><br>  验证中      : <span class="hljs-number">2</span>:docker-common<span class="hljs-number">-1.13</span><span class="hljs-number">.1</span><span class="hljs-number">-108.</span>git4ef4b30.el7.centos.x86_64                      <span class="hljs-number">1</span>/<span class="hljs-number">3</span><br>  验证中      : <span class="hljs-number">2</span>:docker<span class="hljs-number">-1.13</span><span class="hljs-number">.1</span><span class="hljs-number">-108.</span>git4ef4b30.el7.centos.x86_64                             <span class="hljs-number">2</span>/<span class="hljs-number">3</span><br>  验证中      : <span class="hljs-number">2</span>:docker-client<span class="hljs-number">-1.13</span><span class="hljs-number">.1</span><span class="hljs-number">-108.</span>git4ef4b30.el7.centos.x86_64                      <span class="hljs-number">3</span>/<span class="hljs-number">3</span><br><br>删除:<br>  docker.x86_64 <span class="hljs-number">2</span>:<span class="hljs-number">1.13</span><span class="hljs-number">.1</span><span class="hljs-number">-108.</span>git4ef4b30.el7.centos<br>  docker-client.x86_64 <span class="hljs-number">2</span>:<span class="hljs-number">1.13</span><span class="hljs-number">.1</span><span class="hljs-number">-108.</span>git4ef4b30.el7.centos<br>  docker-common.x86_64 <span class="hljs-number">2</span>:<span class="hljs-number">1.13</span><span class="hljs-number">.1</span><span class="hljs-number">-108.</span>git4ef4b30.el7.centos<br><br>完毕！<br>[<span class="hljs-symbol">root@</span>VM_0_6_centos harbor]# yum install -y yum-utils \<br>   device-mapper-persistent-data \<br>   lvm2<br>已加载插件：fastestmirror, langpacks<br>Loading mirror speeds <span class="hljs-keyword">from</span> cached hostfile<br>软件包 yum-utils<span class="hljs-number">-1.1</span><span class="hljs-number">.31</span><span class="hljs-number">-52.</span>el7.noarch 已安装并且是最新版本<br>软件包 device-mapper-persistent-data<span class="hljs-number">-0.8</span><span class="hljs-number">.5</span><span class="hljs-number">-1.</span>el7.x86_64 已安装并且是最新版本<br>软件包 <span class="hljs-number">7</span>:lvm2<span class="hljs-number">-2.02</span><span class="hljs-number">.185</span><span class="hljs-number">-2.</span>el7_7<span class="hljs-number">.2</span>.x86_64 已安装并且是最新版本<br>无须任何处理<br>[<span class="hljs-symbol">root@</span>VM_0_6_centos harbor]# yum-config-manager \<br>     --add-repo \<br>     https:<span class="hljs-comment">//download.docker.com/linux/centos/docker-ce.repo</span><br>已加载插件：fastestmirror, langpacks<br>adding repo <span class="hljs-keyword">from</span>: https:<span class="hljs-comment">//download.docker.com/linux/centos/docker-ce.repo</span><br>grabbing file https:<span class="hljs-comment">//download.docker.com/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.repo</span><br>repo saved to /etc/yum.repos.d/docker-ce.repo<br>[<span class="hljs-symbol">root@</span>VM_0_6_centos harbor]# yum install docker-ce docker-ce-cli containerd.io<br>已加载插件：fastestmirror, langpacks<br>Loading mirror speeds <span class="hljs-keyword">from</span> cached hostfile<br>docker-ce-stable                                                          | <span class="hljs-number">3.5</span> kB  <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br>(<span class="hljs-number">1</span>/<span class="hljs-number">2</span>): docker-ce-stable/x86_64/updateinfo                                 |   <span class="hljs-number">55</span> B  <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br>(<span class="hljs-number">2</span>/<span class="hljs-number">2</span>): docker-ce-stable/x86_64/primary_db                                 |  <span class="hljs-number">38</span> kB  <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br>正在解决依赖关系<br>--&gt; 正在检查事务<br>---&gt; 软件包 containerd.io.x86_64<span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-number">.2</span><span class="hljs-number">.10</span><span class="hljs-number">-3.2</span>.el7 将被 安装<br>---&gt; 软件包 docker-ce.x86_64<span class="hljs-number">.3</span><span class="hljs-number">.19</span><span class="hljs-number">.03</span><span class="hljs-number">.6</span><span class="hljs-number">-3.</span>el7 将被 安装<br>---&gt; 软件包 docker-ce-cli.x86_64<span class="hljs-number">.1</span><span class="hljs-number">.19</span><span class="hljs-number">.03</span><span class="hljs-number">.6</span><span class="hljs-number">-3.</span>el7 将被 安装<br>--&gt; 解决依赖关系完成<br><br>依赖关系解决<br><br>=================================================================================================<br> Package                架构            版本                     源                         大小<br>=================================================================================================<br>正在安装:<br> containerd.io          x86_64          <span class="hljs-number">1.2</span><span class="hljs-number">.10</span><span class="hljs-number">-3.2</span>.el7           docker-ce-stable           <span class="hljs-number">23</span> M<br> docker-ce              x86_64          <span class="hljs-number">3</span>:<span class="hljs-number">19.03</span><span class="hljs-number">.6</span><span class="hljs-number">-3.</span>el7          docker-ce-stable           <span class="hljs-number">24</span> M<br> docker-ce-cli          x86_64          <span class="hljs-number">1</span>:<span class="hljs-number">19.03</span><span class="hljs-number">.6</span><span class="hljs-number">-3.</span>el7          docker-ce-stable           <span class="hljs-number">40</span> M<br><br>事务概要<br>=================================================================================================<br>安装  <span class="hljs-number">3</span> 软件包<br><br>总下载量：<span class="hljs-number">87</span> M<br>安装大小：<span class="hljs-number">363</span> M<br>Is <span class="hljs-keyword">this</span> ok [y/d/N]: y<br>Downloading packages:<br>警告：/var/cache/yum/x86_64/<span class="hljs-number">7</span>/docker-ce-stable/packages/containerd.io<span class="hljs-number">-1.2</span><span class="hljs-number">.10</span><span class="hljs-number">-3.2</span>.el7.x86_64.rpm: 头V4 RSA/SHA512 Signature, 密钥 ID <span class="hljs-number">621e9f</span>35: NOKEY<br>containerd.io<span class="hljs-number">-1.2</span><span class="hljs-number">.10</span><span class="hljs-number">-3.2</span>.el7.x86_64.rpm 的公钥尚未安装<br>(<span class="hljs-number">1</span>/<span class="hljs-number">3</span>): containerd.io<span class="hljs-number">-1.2</span><span class="hljs-number">.10</span><span class="hljs-number">-3.2</span>.el7.x86_64.rpm                            |  <span class="hljs-number">23</span> MB  <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">33</span><br>(<span class="hljs-number">2</span>/<span class="hljs-number">3</span>): docker-ce-cli<span class="hljs-number">-19.03</span><span class="hljs-number">.6</span><span class="hljs-number">-3.</span>el7.x86_64.rpm                             |  <span class="hljs-number">40</span> MB  <span class="hljs-number">00</span>:<span class="hljs-number">01</span>:<span class="hljs-number">08</span><br>docker-ce<span class="hljs-number">-19.03</span><span class="hljs-number">.6</span><span class="hljs-number">-3.</span>el7.x86_64 FAILED                                           MB <span class="hljs-number">418</span>:<span class="hljs-number">34</span>:<span class="hljs-number">55</span> ETA<br>https:<span class="hljs-comment">//download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-19.03.6-3.el7.x86_64.rpm: [Errno 12] Timeout on https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-19.03.6-3.el7.x86_64.rpm: (28, 'Operation too slow. Less than 1000 bytes/sec transferred the last 30 seconds')</span><br>正在尝试其它镜像。<br>docker-ce<span class="hljs-number">-19.03</span><span class="hljs-number">.6</span><span class="hljs-number">-3.</span>el7.x86_64 FAILED                                          MB <span class="hljs-number">2053</span>:<span class="hljs-number">51</span>:<span class="hljs-number">03</span> ETA<br>https:<span class="hljs-comment">//download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-19.03.6-3.el7.x86_64.rpm: [Errno 12] Timeout on https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-19.03.6-3.el7.x86_64.rpm: (28, 'Operation too slow. Less than 1000 bytes/sec transferred the last 30 seconds')</span><br>正在尝试其它镜像。<br>(<span class="hljs-number">3</span>/<span class="hljs-number">3</span>): docker-ce<span class="hljs-number">-19.03</span><span class="hljs-number">.6</span><span class="hljs-number">-3.</span>el7.x86_64.rpm                                 |  <span class="hljs-number">24</span> MB  <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">22</span><br>-------------------------------------------------------------------------------------------------<br>总计                                                             <span class="hljs-number">358</span> kB/s |  <span class="hljs-number">87</span> MB  <span class="hljs-number">00</span>:<span class="hljs-number">04</span>:<span class="hljs-number">09</span><br>从 https:<span class="hljs-comment">//download.docker.com/linux/centos/gpg 检索密钥</span><br>导入 GPG key <span class="hljs-number">0x621E9F35</span>:<br> 用户ID     : <span class="hljs-string">"Docker Release (CE rpm) &lt;docker@docker.com&gt;"</span><br> 指纹       : <span class="hljs-number">060</span>a <span class="hljs-number">61</span>c5 <span class="hljs-number">1</span>b55 <span class="hljs-number">8</span>a7f <span class="hljs-number">742</span>b <span class="hljs-number">77</span>aa c52f eb6b <span class="hljs-number">621</span>e <span class="hljs-number">9f</span>35<br> 来自       : https:<span class="hljs-comment">//download.docker.com/linux/centos/gpg</span><br>是否继续？[y/N]：y<br>Running transaction check<br>Running transaction test<br>Transaction test succeeded<br>Running transaction<br>  正在安装    : containerd.io<span class="hljs-number">-1.2</span><span class="hljs-number">.10</span><span class="hljs-number">-3.2</span>.el7.x86_64                                          <span class="hljs-number">1</span>/<span class="hljs-number">3</span><br>  正在安装    : <span class="hljs-number">1</span>:docker-ce-cli<span class="hljs-number">-19.03</span><span class="hljs-number">.6</span><span class="hljs-number">-3.</span>el7.x86_64                                         <span class="hljs-number">2</span>/<span class="hljs-number">3</span><br>  正在安装    : <span class="hljs-number">3</span>:docker-ce<span class="hljs-number">-19.03</span><span class="hljs-number">.6</span><span class="hljs-number">-3.</span>el7.x86_64                                             <span class="hljs-number">3</span>/<span class="hljs-number">3</span><br>  验证中      : <span class="hljs-number">3</span>:docker-ce<span class="hljs-number">-19.03</span><span class="hljs-number">.6</span><span class="hljs-number">-3.</span>el7.x86_64                                             <span class="hljs-number">1</span>/<span class="hljs-number">3</span><br>  验证中      : <span class="hljs-number">1</span>:docker-ce-cli<span class="hljs-number">-19.03</span><span class="hljs-number">.6</span><span class="hljs-number">-3.</span>el7.x86_64                                         <span class="hljs-number">2</span>/<span class="hljs-number">3</span><br>  验证中      : containerd.io<span class="hljs-number">-1.2</span><span class="hljs-number">.10</span><span class="hljs-number">-3.2</span>.el7.x86_64                                          <span class="hljs-number">3</span>/<span class="hljs-number">3</span><br><br>已安装:<br>  containerd.io.x86_64 <span class="hljs-number">0</span>:<span class="hljs-number">1.2</span><span class="hljs-number">.10</span><span class="hljs-number">-3.2</span>.el7             docker-ce.x86_64 <span class="hljs-number">3</span>:<span class="hljs-number">19.03</span><span class="hljs-number">.6</span><span class="hljs-number">-3.</span>el7<br>  docker-ce-cli.x86_64 <span class="hljs-number">1</span>:<span class="hljs-number">19.03</span><span class="hljs-number">.6</span><span class="hljs-number">-3.</span>el7<br><br>完毕！<br>[<span class="hljs-symbol">root@</span>VM_0_6_centos harbor]# systemctl start docker<br>[<span class="hljs-symbol">root@</span>VM_0_6_centos harbor]# docker --version<br>Docker version <span class="hljs-number">19.03</span><span class="hljs-number">.6</span>, build <span class="hljs-number">369</span>ce74a3c<br></code></pre></td></tr></table></figure>
<p>配置harbor：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[root@VM_0_6_centos harbor]# cat harbor.yml<br><span class="hljs-comment"># Configuration file of Harbor</span><br><br><span class="hljs-comment"># The IP address or hostname to access admin UI and registry service.</span><br><span class="hljs-comment"># DO NOT use localhost or 127.0.0.1, because Harbor needs to be accessed by external clients.</span><br>hostname: www.lumitest.com<br><br><span class="hljs-comment"># http related config</span><br>http:<br>  #<span class="hljs-built_in"> port </span><span class="hljs-keyword">for</span> http,<span class="hljs-built_in"> default </span>is 80. <span class="hljs-keyword">If</span> https enabled, this<span class="hljs-built_in"> port </span>will redirect <span class="hljs-keyword">to</span> https port<br>  port: 80<br><br><span class="hljs-comment"># https related config</span><br>https:<br>  # https<span class="hljs-built_in"> port </span><span class="hljs-keyword">for</span> harbor,<span class="hljs-built_in"> default </span>is 443<br>  port: 443<br>  # The path of cert <span class="hljs-keyword">and</span> key files <span class="hljs-keyword">for</span> nginx<br>  certificate: /etc/ssl/harbor/www.lumitest.com.crt<br>  private_key: /etc/ssl/harbor/www.lumitest.com.key<br><br><span class="hljs-comment"># Uncomment external_url if you want to enable external proxy</span><br><span class="hljs-comment"># And when it enabled the hostname will no longer used</span><br><span class="hljs-comment"># external_url: https://reg.mydomain.com:8433</span><br><br><span class="hljs-comment"># The initial password of Harbor admin</span><br><span class="hljs-comment"># It only works in first time to install harbor</span><br><span class="hljs-comment"># Remember Change the admin password from UI after launching Harbor.</span><br>harbor_admin_password: your_passwd<br><br><span class="hljs-comment"># Harbor DB configuration</span><br>database:<br>  # The password <span class="hljs-keyword">for</span> the root<span class="hljs-built_in"> user </span>of Harbor DB. Change this before any production use.<br>  password: your_passwd<br>  # The maximum number of connections <span class="hljs-keyword">in</span> the idle<span class="hljs-built_in"> connection </span>pool. <span class="hljs-keyword">If</span> it &lt;=0, <span class="hljs-literal">no</span> idle connections are retained.<br>  max_idle_conns: 50<br>  # The maximum number of open connections <span class="hljs-keyword">to</span> the database. <span class="hljs-keyword">If</span> it &lt;= 0, then there is <span class="hljs-literal">no</span> limit on the number of open connections.<br>  # Note: the<span class="hljs-built_in"> default </span>number of connections is 100 <span class="hljs-keyword">for</span> postgres.<br>  max_open_conns: 100<br><br><span class="hljs-comment"># The default data volume</span><br>data_volume: /data/registry/<br><br><span class="hljs-comment"># Harbor Storage settings by default is using /data dir on local filesystem</span><br><span class="hljs-comment"># Uncomment storage_service setting If you want to using external storage</span><br><span class="hljs-comment"># storage_service:</span><br><span class="hljs-comment">#   # ca_bundle is the path to the custom root ca certificate, which will be injected into the truststore</span><br><span class="hljs-comment">#   # of registry's and chart repository's containers.  This is usually needed when the user hosts a internal storage with self signed certificate.</span><br><span class="hljs-comment">#   ca_bundle:</span><br><br><span class="hljs-comment">#   # storage backend, default is filesystem, options include filesystem, azure, gcs, s3, swift and oss</span><br><span class="hljs-comment">#   # for more info about this configuration please refer https://docs.docker.com/registry/configuration/</span><br><span class="hljs-comment">#   filesystem:</span><br><span class="hljs-comment">#     maxthreads: 100</span><br><span class="hljs-comment">#   # set disable to true when you want to disable registry redirect</span><br><span class="hljs-comment">#   redirect:</span><br><span class="hljs-comment">#     disabled: false</span><br><br><span class="hljs-comment"># Clair configuration</span><br>clair:<br>  # The interval of clair updaters, the unit is hour, <span class="hljs-builtin-name">set</span> <span class="hljs-keyword">to</span> 0 <span class="hljs-keyword">to</span> <span class="hljs-builtin-name">disable</span> the updaters.<br>  updaters_interval: 12<br><br>jobservice:<br>  # Maximum number of job workers <span class="hljs-keyword">in</span> job service<br>  max_job_workers: 10<br><br>notification:<br>  # Maximum retry count <span class="hljs-keyword">for</span> webhook job<br>  webhook_job_max_retry: 10<br><br>chart:<br>  # Change the value of absolute_url <span class="hljs-keyword">to</span> enabled can <span class="hljs-builtin-name">enable</span> absolute url <span class="hljs-keyword">in</span> chart<br>  absolute_url: disabled<br><br><span class="hljs-comment"># Log configurations</span><br>log:<br>  # options are debug, info, warning, error, fatal<br>  level: info<br>  # configs <span class="hljs-keyword">for</span> logs <span class="hljs-keyword">in</span> local storage<br>  local:<br>    # Log files are rotated log_rotate_count times before being removed. <span class="hljs-keyword">If</span> count is 0, old versions are removed rather than rotated.<br>    rotate_count: 50<br>    # Log files are rotated only <span class="hljs-keyword">if</span> they grow bigger than log_rotate_size bytes. <span class="hljs-keyword">If</span> size is followed by k, the size is assumed <span class="hljs-keyword">to</span> be <span class="hljs-keyword">in</span> kilobytes.<br>    # <span class="hljs-keyword">If</span> the M is used, the size is <span class="hljs-keyword">in</span> megabytes, <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span> G is used, the size is <span class="hljs-keyword">in</span> gigabytes. So size 100, size 100k, size 100M <span class="hljs-keyword">and</span> size 100G<br>    # are all valid.<br>    rotate_size: 200M<br>    # The directory on your host that store log<br>    location: /var/log/harbor<br><br>  # Uncomment following lines <span class="hljs-keyword">to</span> <span class="hljs-builtin-name">enable</span> external syslog endpoint.<br>  # external_endpoint:<br>  #   # protocol used <span class="hljs-keyword">to</span> transmit log <span class="hljs-keyword">to</span> external endpoint, options is tcp <span class="hljs-keyword">or</span> udp<br>  #   protocol: tcp<br>  #   # The host of external endpoint<br>  #   host: localhost<br>  #   #<span class="hljs-built_in"> Port </span>of external endpoint<br>  #   port: 5140<br><br><span class="hljs-comment">#This attribute is for migrator to detect the version of the .cfg file, DO NOT MODIFY!</span><br>_version: 1.10.0<br><br><span class="hljs-comment"># Uncomment external_database if using external database.</span><br><span class="hljs-comment"># external_database:</span><br><span class="hljs-comment">#   harbor:</span><br><span class="hljs-comment">#     host: harbor_db_host</span><br><span class="hljs-comment">#     port: harbor_db_port</span><br><span class="hljs-comment">#     db_name: harbor_db_name</span><br><span class="hljs-comment">#     username: harbor_db_username</span><br><span class="hljs-comment">#     password: harbor_db_password</span><br><span class="hljs-comment">#     ssl_mode: disable</span><br><span class="hljs-comment">#     max_idle_conns: 2</span><br><span class="hljs-comment">#     max_open_conns: 0</span><br><span class="hljs-comment">#   clair:</span><br><span class="hljs-comment">#     host: clair_db_host</span><br><span class="hljs-comment">#     port: clair_db_port</span><br><span class="hljs-comment">#     db_name: clair_db_name</span><br><span class="hljs-comment">#     username: clair_db_username</span><br><span class="hljs-comment">#     password: clair_db_password</span><br><span class="hljs-comment">#     ssl_mode: disable</span><br><span class="hljs-comment">#   notary_signer:</span><br><span class="hljs-comment">#     host: notary_signer_db_host</span><br><span class="hljs-comment">#     port: notary_signer_db_port</span><br><span class="hljs-comment">#     db_name: notary_signer_db_name</span><br><span class="hljs-comment">#     username: notary_signer_db_username</span><br><span class="hljs-comment">#     password: notary_signer_db_password</span><br><span class="hljs-comment">#     ssl_mode: disable</span><br><span class="hljs-comment">#   notary_server:</span><br><span class="hljs-comment">#     host: notary_server_db_host</span><br><span class="hljs-comment">#     port: notary_server_db_port</span><br><span class="hljs-comment">#     db_name: notary_server_db_name</span><br><span class="hljs-comment">#     username: notary_server_db_username</span><br><span class="hljs-comment">#     password: notary_server_db_password</span><br><span class="hljs-comment">#     ssl_mode: disable</span><br><br><span class="hljs-comment"># Uncomment external_redis if using external Redis server</span><br><span class="hljs-comment"># external_redis:</span><br><span class="hljs-comment">#   host: redis</span><br><span class="hljs-comment">#   port: 6379</span><br><span class="hljs-comment">#   password:</span><br><span class="hljs-comment">#   # db_index 0 is for core, it's unchangeable</span><br><span class="hljs-comment">#   registry_db_index: 1</span><br><span class="hljs-comment">#   jobservice_db_index: 2</span><br><span class="hljs-comment">#   chartmuseum_db_index: 3</span><br><span class="hljs-comment">#   clair_db_index: 4</span><br><br><span class="hljs-comment"># Uncomment uaa for trusting the certificate of uaa instance that is hosted via self-signed cert.</span><br><span class="hljs-comment"># uaa:</span><br><span class="hljs-comment">#   ca_file: /path/to/ca</span><br><br><span class="hljs-comment"># Global proxy</span><br><span class="hljs-comment"># Config http proxy for components, e.g. http://my.proxy.com:3128</span><br><span class="hljs-comment"># Components doesn't need to connect to each others via http proxy.</span><br><span class="hljs-comment"># Remove component from `components` array if want disable proxy</span><br><span class="hljs-comment"># for it. If you want use proxy for replication, MUST enable proxy</span><br><span class="hljs-comment"># for core and jobservice, and set `http_proxy` and `https_proxy`.</span><br><span class="hljs-comment"># Add domain to the `no_proxy` field, when you want disable proxy</span><br><span class="hljs-comment"># for some special registry.</span><br>proxy:<br>  http_proxy:<br>  https_proxy:<br>  # no_proxy endpoints will appended <span class="hljs-keyword">to</span> 127.0.0.1,localhost,.local,.internal,log,db,redis,nginx,core,portal,postgresql,jobservice,registry,registryctl,clair,chartmuseum,notary-server<br>  no_proxy:<br>  components:<br>    - core<br>    - jobservice<br>    - clair<br></code></pre></td></tr></table></figure>
<p>启动：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">[<span class="hljs-symbol">root@</span>VM_0_6_centos harbor]# ./install.sh --with-notary --with-clair<br><br>[Step <span class="hljs-number">0</span>]: checking <span class="hljs-keyword">if</span> docker <span class="hljs-keyword">is</span> installed ...<br><br>Note: docker version: <span class="hljs-number">19.03</span><span class="hljs-number">.6</span><br><br>[Step <span class="hljs-number">1</span>]: checking docker-compose <span class="hljs-keyword">is</span> installed ...<br><br>Note: docker-compose version: <span class="hljs-number">1.25</span><span class="hljs-number">.4</span><br><br>[Step <span class="hljs-number">2</span>]: loading Harbor images ...<br><span class="hljs-number">47</span>a4bb1cfbc7: Loading layer  <span class="hljs-number">34.26</span>MB/<span class="hljs-number">34.26</span>MB<br>c2d9cf7a4eaf: Loading layer  <span class="hljs-number">9.056</span>MB/<span class="hljs-number">9.056</span>MB<br><span class="hljs-number">32</span>b7eca4f03e: Loading layer   <span class="hljs-number">9.71</span>MB/<span class="hljs-number">9.71</span>MB<br><span class="hljs-number">5</span>d104292391f: Loading layer   <span class="hljs-number">9.71</span>MB/<span class="hljs-number">9.71</span>MB<br>Loaded image: goharbor/clair-adapter-photon:v1<span class="hljs-number">.0</span><span class="hljs-number">.1</span>-v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br><span class="hljs-number">0039915754</span>c6: Loading layer  <span class="hljs-number">12.83</span>MB/<span class="hljs-number">12.83</span>MB<br><span class="hljs-number">0</span>a4ba5bc8bc2: Loading layer  <span class="hljs-number">49.37</span>MB/<span class="hljs-number">49.37</span>MB<br>Loaded image: goharbor/harbor-jobservice:v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br>db95a8bece9e: Loading layer  <span class="hljs-number">78.32</span>MB/<span class="hljs-number">78.32</span>MB<br>f9aa9f9a3393: Loading layer  <span class="hljs-number">3.072</span>kB/<span class="hljs-number">3.072</span>kB<br>f0baa86a6ccd: Loading layer   <span class="hljs-number">59.9</span>kB/<span class="hljs-number">59.9</span>kB<br><span class="hljs-number">2</span>b8f0a44b78f: Loading layer  <span class="hljs-number">61.95</span>kB/<span class="hljs-number">61.95</span>kB<br>Loaded image: goharbor/redis-photon:v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br>a9f6374f6301: Loading layer   <span class="hljs-number">9.05</span>MB/<span class="hljs-number">9.05</span>MB<br>b3c39a738965: Loading layer  <span class="hljs-number">6.239</span>MB/<span class="hljs-number">6.239</span>MB<br>dce1aa68054e: Loading layer  <span class="hljs-number">16.04</span>MB/<span class="hljs-number">16.04</span>MB<br><span class="hljs-number">612</span>aac9b538e: Loading layer  <span class="hljs-number">28.24</span>MB/<span class="hljs-number">28.24</span>MB<br><span class="hljs-number">8612386f</span>b841: Loading layer  <span class="hljs-number">22.02</span>kB/<span class="hljs-number">22.02</span>kB<br><span class="hljs-number">53883649</span>d694: Loading layer  <span class="hljs-number">50.52</span>MB/<span class="hljs-number">50.52</span>MB<br>Loaded image: goharbor/notary-server-photon:v0<span class="hljs-number">.6</span><span class="hljs-number">.1</span>-v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br>f3967aa0de5f: Loading layer  <span class="hljs-number">115.8</span>MB/<span class="hljs-number">115.8</span>MB<br><span class="hljs-number">42f</span>d590be962: Loading layer  <span class="hljs-number">12.14</span>MB/<span class="hljs-number">12.14</span>MB<br><span class="hljs-number">096</span>b03f3e32b: Loading layer  <span class="hljs-number">3.072</span>kB/<span class="hljs-number">3.072</span>kB<br>aa66bf3b8224: Loading layer  <span class="hljs-number">49.15</span>kB/<span class="hljs-number">49.15</span>kB<br><span class="hljs-number">8e76391190</span>c9: Loading layer  <span class="hljs-number">3.584</span>kB/<span class="hljs-number">3.584</span>kB<br><span class="hljs-number">131573</span>c722d5: Loading layer  <span class="hljs-number">13.02</span>MB/<span class="hljs-number">13.02</span>MB<br>Loaded image: goharbor/clair-photon:v2<span class="hljs-number">.1</span><span class="hljs-number">.1</span>-v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br><span class="hljs-number">69e43242f</span>f64: Loading layer  <span class="hljs-number">50.39</span>MB/<span class="hljs-number">50.39</span>MB<br><span class="hljs-number">5</span>a3a8e835993: Loading layer  <span class="hljs-number">3.584</span>kB/<span class="hljs-number">3.584</span>kB<br><span class="hljs-number">4</span>dff480c159c: Loading layer  <span class="hljs-number">3.072</span>kB/<span class="hljs-number">3.072</span>kB<br><span class="hljs-number">2</span>be454a39481: Loading layer   <span class="hljs-number">2.56</span>kB/<span class="hljs-number">2.56</span>kB<br>d6b4877d5c4e: Loading layer  <span class="hljs-number">3.072</span>kB/<span class="hljs-number">3.072</span>kB<br><span class="hljs-number">609537197</span>cce: Loading layer  <span class="hljs-number">3.584</span>kB/<span class="hljs-number">3.584</span>kB<br>b52d06cad304: Loading layer  <span class="hljs-number">12.29</span>kB/<span class="hljs-number">12.29</span>kB<br>Loaded image: goharbor/harbor-log:v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br>badcf9296df7: Loading layer  <span class="hljs-number">9.056</span>MB/<span class="hljs-number">9.056</span>MB<br><span class="hljs-number">8</span>b17ed0102b2: Loading layer  <span class="hljs-number">3.584</span>kB/<span class="hljs-number">3.584</span>kB<br><span class="hljs-number">4</span>d1cd50b8d4f: Loading layer  <span class="hljs-number">3.072</span>kB/<span class="hljs-number">3.072</span>kB<br><span class="hljs-number">491</span>c41e50d6a: Loading layer  <span class="hljs-number">21.76</span>MB/<span class="hljs-number">21.76</span>MB<br><span class="hljs-number">0101</span>dc4148c7: Loading layer  <span class="hljs-number">22.59</span>MB/<span class="hljs-number">22.59</span>MB<br>Loaded image: goharbor/registry-photon:v2<span class="hljs-number">.7</span><span class="hljs-number">.1</span>-patch<span class="hljs-number">-2819</span><span class="hljs-number">-2553</span>-v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br><span class="hljs-number">77965</span>b8f534b: Loading layer  <span class="hljs-number">14.61</span>MB/<span class="hljs-number">14.61</span>MB<br><span class="hljs-number">940</span>bf05c9601: Loading layer  <span class="hljs-number">28.24</span>MB/<span class="hljs-number">28.24</span>MB<br><span class="hljs-number">7</span>ca206eb72e3: Loading layer  <span class="hljs-number">22.02</span>kB/<span class="hljs-number">22.02</span>kB<br><span class="hljs-number">9898774</span>a5bad: Loading layer  <span class="hljs-number">49.09</span>MB/<span class="hljs-number">49.09</span>MB<br>Loaded image: goharbor/notary-signer-photon:v0<span class="hljs-number">.6</span><span class="hljs-number">.1</span>-v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br><span class="hljs-number">86340</span>c56281e: Loading layer  <span class="hljs-number">9.055</span>MB/<span class="hljs-number">9.055</span>MB<br><span class="hljs-number">8</span>ac45c34690f: Loading layer  <span class="hljs-number">42.31</span>MB/<span class="hljs-number">42.31</span>MB<br><span class="hljs-number">4</span>aa70453f992: Loading layer  <span class="hljs-number">3.072</span>kB/<span class="hljs-number">3.072</span>kB<br><span class="hljs-number">6</span>cbc6ab111b2: Loading layer  <span class="hljs-number">3.584</span>kB/<span class="hljs-number">3.584</span>kB<br>d6d7b70c18b5: Loading layer  <span class="hljs-number">43.14</span>MB/<span class="hljs-number">43.14</span>MB<br>Loaded image: goharbor/chartmuseum-photon:v0<span class="hljs-number">.9</span><span class="hljs-number">.0</span>-v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br><span class="hljs-number">07</span>efa003923d: Loading layer  <span class="hljs-number">9.056</span>MB/<span class="hljs-number">9.056</span>MB<br><span class="hljs-number">96</span>dd65c291de: Loading layer  <span class="hljs-number">3.584</span>kB/<span class="hljs-number">3.584</span>kB<br><span class="hljs-number">802</span>a1397679e: Loading layer  <span class="hljs-number">21.76</span>MB/<span class="hljs-number">21.76</span>MB<br><span class="hljs-number">92</span>c283f6895a: Loading layer  <span class="hljs-number">3.072</span>kB/<span class="hljs-number">3.072</span>kB<br><span class="hljs-number">8</span>b61b91240a6: Loading layer  <span class="hljs-number">8.662</span>MB/<span class="hljs-number">8.662</span>MB<br><span class="hljs-number">1f</span>d753477b6f: Loading layer  <span class="hljs-number">31.24</span>MB/<span class="hljs-number">31.24</span>MB<br>Loaded image: goharbor/harbor-registryctl:v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br><span class="hljs-number">48</span>cda078e98d: Loading layer  <span class="hljs-number">10.89</span>MB/<span class="hljs-number">10.89</span>MB<br>Loaded image: goharbor/nginx-photon:v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br><span class="hljs-number">2</span>c00d9af2c3f: Loading layer  <span class="hljs-number">34.31</span>MB/<span class="hljs-number">34.31</span>MB<br><span class="hljs-number">0e4</span>ae15c3d4e: Loading layer  <span class="hljs-number">339.9</span>MB/<span class="hljs-number">339.9</span>MB<br><span class="hljs-number">27810</span>c9ff1a9: Loading layer  <span class="hljs-number">135.2</span>kB/<span class="hljs-number">135.2</span>kB<br>Loaded image: goharbor/harbor-migrator:v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br><span class="hljs-number">93e0577272</span>a9: Loading layer  <span class="hljs-number">34.24</span>MB/<span class="hljs-number">34.24</span>MB<br>fb3507ff707e: Loading layer  <span class="hljs-number">117.4</span>MB/<span class="hljs-number">117.4</span>MB<br>f59c6315bf8a: Loading layer  <span class="hljs-number">42.32</span>MB/<span class="hljs-number">42.32</span>MB<br><span class="hljs-number">5</span>c5501748347: Loading layer   <span class="hljs-number">2.56</span>kB/<span class="hljs-number">2.56</span>kB<br><span class="hljs-number">3710</span>d94e58dd: Loading layer  <span class="hljs-number">1.536</span>kB/<span class="hljs-number">1.536</span>kB<br><span class="hljs-number">06e0f</span>1585c01: Loading layer  <span class="hljs-number">166.4</span>kB/<span class="hljs-number">166.4</span>kB<br>bf5ac9b9c61c: Loading layer   <span class="hljs-number">3.01</span>MB/<span class="hljs-number">3.01</span>MB<br>Loaded image: goharbor/prepare:v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br><span class="hljs-number">9</span>ea2dad46741: Loading layer  <span class="hljs-number">10.89</span>MB/<span class="hljs-number">10.89</span>MB<br>b280b9e7ca3b: Loading layer  <span class="hljs-number">7.696</span>MB/<span class="hljs-number">7.696</span>MB<br>a1ce7c1130ee: Loading layer  <span class="hljs-number">223.2</span>kB/<span class="hljs-number">223.2</span>kB<br><span class="hljs-number">3</span>b0492a7358b: Loading layer  <span class="hljs-number">195.1</span>kB/<span class="hljs-number">195.1</span>kB<br>c64d6e6c80dd: Loading layer  <span class="hljs-number">15.36</span>kB/<span class="hljs-number">15.36</span>kB<br>ace4e9064f06: Loading layer  <span class="hljs-number">3.584</span>kB/<span class="hljs-number">3.584</span>kB<br>Loaded image: goharbor/harbor-portal:v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br>b74d8257d4e7: Loading layer  <span class="hljs-number">12.83</span>MB/<span class="hljs-number">12.83</span>MB<br><span class="hljs-number">92f</span>141040819: Loading layer   <span class="hljs-number">42.5</span>MB/<span class="hljs-number">42.5</span>MB<br><span class="hljs-number">33</span>c99383fac5: Loading layer  <span class="hljs-number">5.632</span>kB/<span class="hljs-number">5.632</span>kB<br><span class="hljs-number">2</span>bacc160d10f: Loading layer  <span class="hljs-number">40.45</span>kB/<span class="hljs-number">40.45</span>kB<br>f51bed904fbe: Loading layer   <span class="hljs-number">42.5</span>MB/<span class="hljs-number">42.5</span>MB<br>Loaded image: goharbor/harbor-core:v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br>a2ffdaaa3434: Loading layer  <span class="hljs-number">63.56</span>MB/<span class="hljs-number">63.56</span>MB<br><span class="hljs-number">5745</span>ac9e0297: Loading layer  <span class="hljs-number">54.44</span>MB/<span class="hljs-number">54.44</span>MB<br>dc1d24cbb1d5: Loading layer  <span class="hljs-number">5.632</span>kB/<span class="hljs-number">5.632</span>kB<br><span class="hljs-number">4280f</span>2f98340: Loading layer  <span class="hljs-number">2.048</span>kB/<span class="hljs-number">2.048</span>kB<br><span class="hljs-number">0f</span>9279b20eec: Loading layer   <span class="hljs-number">2.56</span>kB/<span class="hljs-number">2.56</span>kB<br><span class="hljs-number">8</span>b9162d25131: Loading layer   <span class="hljs-number">2.56</span>kB/<span class="hljs-number">2.56</span>kB<br><span class="hljs-number">50</span>ad7481e5af: Loading layer   <span class="hljs-number">2.56</span>kB/<span class="hljs-number">2.56</span>kB<br><span class="hljs-number">54</span>b809bfb5ec: Loading layer  <span class="hljs-number">10.24</span>kB/<span class="hljs-number">10.24</span>kB<br>Loaded image: goharbor/harbor-db:v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br><br><br>[Step <span class="hljs-number">3</span>]: preparing environment ...<br><br>[Step <span class="hljs-number">4</span>]: preparing harbor configs ...<br>prepare base dir <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span> to /data/install/harbor<br>Generated configuration file: /config/log/logrotate.conf<br>Generated configuration file: /config/log/rsyslog_docker.conf<br>Generated configuration file: /config/nginx/nginx.conf<br>Generated configuration file: /config/core/env<br>Generated configuration file: /config/core/app.conf<br>Generated configuration file: /config/registry/config.yml<br>Generated configuration file: /config/registryctl/env<br>Generated configuration file: /config/db/env<br>Generated configuration file: /config/jobservice/env<br>Generated configuration file: /config/jobservice/config.yml<br>Generated <span class="hljs-keyword">and</span> saved secret to file: /secret/keys/secretkey<br>Generated certificate, key file: /secret/core/private_key.pem, cert file: /secret/registry/root.crt<br>Generated certificate, key file: /tmp/cert_tmp/notary-signer-ca.key, cert file: /tmp/cert_tmp/notary-signer-ca.crt<br>Generated certificate, key file: /tmp/cert_tmp/notary-signer.key, cert file: /tmp/cert_tmp/notary-signer.crt<br>Copying certs <span class="hljs-keyword">for</span> notary signer<br>Copying nginx configuration file <span class="hljs-keyword">for</span> notary<br>Generated configuration file: /config/nginx/conf.d/notary.upstream.conf<br>Generated configuration file: /config/nginx/conf.d/notary.server.conf<br>Generated configuration file: /config/notary/server-config.postgres.json<br>Generated configuration file: /config/notary/server_env<br>Generated <span class="hljs-keyword">and</span> saved secret to file: /secret/keys/defaultalias<br>Generated configuration file: /config/notary/signer_env<br>Generated configuration file: /config/notary/signer-config.postgres.json<br>Generated configuration file: /config/clair/postgres_env<br>Generated configuration file: /config/clair/config.yaml<br>Generated configuration file: /config/clair/clair_env<br>Generated configuration file: /config/clair-adapter/env<br>Generated configuration file: /compose_location/docker-compose.yml<br>Clean up the input dir<br><br><br><br>[Step <span class="hljs-number">5</span>]: starting Harbor ...<br>Creating network <span class="hljs-string">"harbor_harbor"</span> with the <span class="hljs-keyword">default</span> driver<br>Creating network <span class="hljs-string">"harbor_harbor-clair"</span> with the <span class="hljs-keyword">default</span> driver<br>Creating network <span class="hljs-string">"harbor_harbor-notary"</span> with the <span class="hljs-keyword">default</span> driver<br>Creating network <span class="hljs-string">"harbor_notary-sig"</span> with the <span class="hljs-keyword">default</span> driver<br>Creating harbor-log ... done<br>Creating registry      ... done<br>Creating harbor-portal ... done<br>Creating redis         ... done<br>Creating harbor-db     ... done<br>Creating registryctl   ... done<br>Creating harbor-core   ... done<br>Creating clair         ... done<br>Creating notary-signer ... done<br>Creating clair-adapter     ... done<br>Creating notary-server     ... done<br>Creating nginx             ... done<br>Creating harbor-jobservice ... done<br>✔ ----Harbor has been installed <span class="hljs-keyword">and</span> started successfully.----<br>[<span class="hljs-symbol">root@</span>VM_0_6_centos harbor]# echo $?<br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<p>配置hosts，登录测试：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@VM_0_6_centos harbor]# vim /etc/hosts<br>[root@VM_0_6_centos harbor]# docker <span class="hljs-keyword">login</span> -uadmin -pyour_passwd www.lumitest.com<br><span class="hljs-built_in">WARNING</span>! <span class="hljs-keyword">Using</span> <span class="hljs-comment">--password via the CLI is insecure. Use --password-stdin.</span><br><span class="hljs-built_in">WARNING</span>! Your <span class="hljs-keyword">password</span> will be stored <span class="hljs-keyword">unencrypted</span> <span class="hljs-keyword">in</span> /root/.docker/config.json.<br>Configure a credential helper <span class="hljs-keyword">to</span> remove this <span class="hljs-built_in">warning</span>. See<br>https://docs.docker.com/engine/reference/commandline/<span class="hljs-keyword">login</span>/#credentials-store<br><br><span class="hljs-keyword">Login</span> Succeeded<br><br>[root@VM_0_6_centos harbor]# docker tag goharbor/nginx-photon:v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span> www.lumitest.com/library/replicate:v1<br>[root@VM_0_6_centos harbor]# docker push www.lumitest.com/library/replicate:v1<br>The push refers <span class="hljs-keyword">to</span> repository [www.lumitest.com/library/replicate]<br><span class="hljs-number">48</span>cda078e98d: Pushed<br><span class="hljs-number">47</span>a4bb1cfbc7: Pushed<br>v1: digest: sha256:<span class="hljs-number">8</span>f900484be88c2f72699996ade92cbcbd84366f386396af0ac093430e6c2f7f2 size: <span class="hljs-number">740</span><br></code></pre></td></tr></table></figure>
<p>证书拷贝到对应主机进行测试：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cs">[<span class="hljs-meta">root@VM_0_6_centos harbor</span>]<span class="hljs-meta"># scp /data/ssl/www.lumitest.com.crt root@172.16.0.8:/etc/pki/ca-trust/source/anchors/</span><br>root@<span class="hljs-number">172.16</span><span class="hljs-number">.0</span><span class="hljs-number">.8'</span>s password:<br>www.lumitest.com.crt                                                                <span class="hljs-number">100</span>% <span class="hljs-number">1931</span>     <span class="hljs-number">6.5</span>MB/s   <span class="hljs-number">00</span>:<span class="hljs-number">00</span><br><br>[<span class="hljs-meta">root@VM_0_8_centos ~</span>]<span class="hljs-meta"># update-ca-trust enable</span><br>[<span class="hljs-meta">root@VM_0_8_centos ~</span>]<span class="hljs-meta"># update-ca-trust extract</span><br>[<span class="hljs-meta">root@VM_0_8_centos ~</span>]<span class="hljs-meta"># sestatus</span><br>SELinux status:                 disabled<br>[<span class="hljs-meta">root@VM_0_8_centos ~</span>]<span class="hljs-meta"># systemctl status firewalld</span><br>● firewalld.service - firewalld - <span class="hljs-keyword">dynamic</span> firewall daemon<br>   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled)<br>   Active: inactive (dead)<br>     Docs: man:firewalld(<span class="hljs-number">1</span>)<br><br>[<span class="hljs-meta">root@VM_0_8_centos ~</span>]<span class="hljs-meta"># docker login -uadmin -pyour_passwd www.lumitest.com</span><br>WARNING! Using --password via the CLI <span class="hljs-keyword">is</span> insecure. Use --password-stdin.<br>WARNING! Your password will be stored unencrypted <span class="hljs-keyword">in</span> /root/.docker/config.json.<br>Configure a credential helper to <span class="hljs-keyword">remove</span> <span class="hljs-keyword">this</span> warning. See<br>https:<span class="hljs-comment">//docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><br>Login Succeeded<br></code></pre></td></tr></table></figure>

<p>解决https认证问题<br><a href="http://www.voidcn.com/article/p-bsvymoes-bav.html" target="_blank" rel="noopener">http://www.voidcn.com/article/p-bsvymoes-bav.html</a></p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span># cat /etc/pki/ca-trust/source/anchors/www.lumitest3.<span class="hljs-keyword">com</span>.crt  &gt;&gt; /etc/pki/tls/certs/ca-bundle.crt<br><span class="hljs-symbol">2 </span># systemctl restart docker<br></code></pre></td></tr></table></figure>
<p>自建证书不被信任，不能创建复制策略需关闭https ssl，改为http方式访问，创建仓库管理及复制管理策略进行同步实验<br><a href="https://postimg.cc/fSDmBcMg" target="_blank" rel="noopener"><img src="https://i.postimg.cc/XqyLNLm3/harbor-ms1.png" alt="harbor-ms1.png"></a></p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">[root@VM_0_6_centos harbor]<span class="hljs-comment"># vim /usr/lib/systemd/system/docker.service</span><br>[root@VM_0_6_centos harbor]<span class="hljs-comment"># systemctl daemon-reload</span><br>[root@VM_0_6_centos harbor]<span class="hljs-comment"># systemctl restart docker</span><br><br>[root@VM_0_6_centos harbor]<span class="hljs-comment"># docker-compose stop</span><br>[root@VM_0_6_centos harbor]<span class="hljs-comment"># ./prepare</span><br>[root@VM_0_6_centos harbor]<span class="hljs-comment"># ./install.sh --with-clair</span><br>[root@VM_0_6_centos harbor]<span class="hljs-comment"># docker login 172.16.0.6</span><br>Username: admin<br>Password:<br>WARNING! Your password will be stored unencrypted <span class="hljs-keyword">in</span> <span class="hljs-regexp">/root/</span>.docker/config.json.<br>Configure a credential helper to remove <span class="hljs-keyword">this</span> warning. See<br>https:<span class="hljs-regexp">//docs.docker.com/engine/reference/commandline/login/</span><span class="hljs-comment">#credentials-store</span><br><br>Login Succeeded<br></code></pre></td></tr></table></figure>
<p>分别在06、08上传不同的镜像，测试两边能否同步</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">[<span class="hljs-symbol">root@</span>VM_0_6_centos harbor]# docker tag goharbor/clair-adapter-photon:v1<span class="hljs-number">.0</span><span class="hljs-number">.1</span>-v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span> <span class="hljs-number">172.16</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span>/library/test:v2<br>[<span class="hljs-symbol">root@</span>VM_0_6_centos harbor]# docker push <span class="hljs-number">172.16</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span>/library/test:v2<br>The push <span class="hljs-built_in">ref</span>ers to repository [<span class="hljs-number">172.16</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span>/library/test]<br><span class="hljs-number">5</span>d104292391f: Pushed<br><span class="hljs-number">32</span>b7eca4f03e: Pushed<br>c2d9cf7a4eaf: Pushed<br><span class="hljs-number">47</span>a4bb1cfbc7: Pushed<br>v2: digest: sha256:<span class="hljs-number">7f</span>ddfab9a6568fed533870efda90e190eba9eb898832c4986dc0ce3d4aae6057 size: <span class="hljs-number">1162</span><br><br>[<span class="hljs-symbol">root@</span>VM_0_8_centos ~]# docker tag goharbor/harbor-log:v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span> <span class="hljs-number">172.16</span><span class="hljs-number">.0</span><span class="hljs-number">.8</span>/library/test8:v3<br>[<span class="hljs-symbol">root@</span>VM_0_8_centos ~]# docker push <span class="hljs-number">172.16</span><span class="hljs-number">.0</span><span class="hljs-number">.8</span>/library/test8:v3<br>The push <span class="hljs-built_in">ref</span>ers to repository [<span class="hljs-number">172.16</span><span class="hljs-number">.0</span><span class="hljs-number">.8</span>/library/test8]<br>b52d06cad304: Pushed<br><span class="hljs-number">609537197</span>cce: Pushed<br>d6b4877d5c4e: Pushed<br><span class="hljs-number">2</span>be454a39481: Pushed<br><span class="hljs-number">4</span>dff480c159c: Pushed<br><span class="hljs-number">5</span>a3a8e835993: Pushed<br><span class="hljs-number">69e43242f</span>f64: Pushed<br><span class="hljs-number">47</span>a4bb1cfbc7: Pushed<br>v3: digest: sha256:bb104098058f359c2cc25ffcb96810ebb69fc8d50e7290331e949e569c868c5d size: <span class="hljs-number">1984</span><br></code></pre></td></tr></table></figure>
<p><a href="https://postimg.cc/qgT59WRW" target="_blank" rel="noopener"><img src="https://i.postimg.cc/ry02tkLy/harbor-ms2.png" alt="harbor-ms2.png"></a></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">[<span class="hljs-symbol">root@</span>VM_0_6_centos harbor]# docker tag goharbor/harbor-portal:v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span> <span class="hljs-number">172.16</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span>/library/test6:v3<br>[<span class="hljs-symbol">root@</span>VM_0_6_centos harbor]# docker push <span class="hljs-number">172.16</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span>/library/test6:v3<br>The push <span class="hljs-built_in">ref</span>ers to repository [<span class="hljs-number">172.16</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span>/library/test6]<br>ace4e9064f06: Pushed<br>c64d6e6c80dd: Pushed<br><span class="hljs-number">3</span>b0492a7358b: Pushed<br>a1ce7c1130ee: Pushed<br>b280b9e7ca3b: Pushed<br><span class="hljs-number">9</span>ea2dad46741: Pushed<br><span class="hljs-number">47</span>a4bb1cfbc7: Mounted <span class="hljs-keyword">from</span> library/test<br>v3: digest: sha256:<span class="hljs-number">5</span>c4481dd645d3c1e52b03e65a7fd4b030e7f8b040ed44a45f66908e24fe3f31a size: <span class="hljs-number">1784</span><br><br>[<span class="hljs-symbol">root@</span>VM_0_8_centos ~]# docker tag goharbor/registry-photon:v2<span class="hljs-number">.7</span><span class="hljs-number">.1</span>-patch<span class="hljs-number">-2819</span><span class="hljs-number">-2553</span>-v1<span class="hljs-number">.10</span><span class="hljs-number">.1</span> <span class="hljs-number">172.16</span><span class="hljs-number">.0</span><span class="hljs-number">.8</span>/library/test08:v4<br>[<span class="hljs-symbol">root@</span>VM_0_8_centos ~]# docker push <span class="hljs-number">172.16</span><span class="hljs-number">.0</span><span class="hljs-number">.8</span>/library/test08:v4<br>The push <span class="hljs-built_in">ref</span>ers to repository [<span class="hljs-number">172.16</span><span class="hljs-number">.0</span><span class="hljs-number">.8</span>/library/test08]<br><span class="hljs-number">0101</span>dc4148c7: Pushed<br><span class="hljs-number">491</span>c41e50d6a: Pushed<br><span class="hljs-number">4</span>d1cd50b8d4f: Pushed<br><span class="hljs-number">8</span>b17ed0102b2: Pushed<br>badcf9296df7: Pushed<br><span class="hljs-number">47</span>a4bb1cfbc7: Pushed<br>v4: digest: sha256:<span class="hljs-number">3</span>ee2e7dc7f93d9b922d382b8454fd017288d8eb8fdfdd022ade81e7c9f171723 size: <span class="hljs-number">1576</span><br></code></pre></td></tr></table></figure>
<p><a href="https://postimg.cc/tZhF3SGx" target="_blank" rel="noopener"><img src="https://i.postimg.cc/tTcDHwr2/harbor-ms3.png" alt="harbor-ms3.png"></a></p>
<p>参考文档：<br><a href="https://www.cnblogs.com/breezey/p/9444231.html" target="_blank" rel="noopener">https://www.cnblogs.com/breezey/p/9444231.html</a><br><a href="https://www.cnblogs.com/wangzhangtao/p/12076816.html" target="_blank" rel="noopener">https://www.cnblogs.com/wangzhangtao/p/12076816.html</a><br>双主复制案例：<br><a href="https://www.dazhuanlan.com/2019/10/12/5da0faae2f6a5/" target="_blank" rel="noopener">https://www.dazhuanlan.com/2019/10/12/5da0faae2f6a5/</a><br><a href="https://segmentfault.com/a/1190000020144752" target="_blank" rel="noopener">https://segmentfault.com/a/1190000020144752</a><br>主从复制案例：<br><a href="http://www.imooc.com/article/270050" target="_blank" rel="noopener">http://www.imooc.com/article/270050</a><br><a href="https://www.cnblogs.com/cash-su/p/10103885.html" target="_blank" rel="noopener">https://www.cnblogs.com/cash-su/p/10103885.html</a></p>

      </section>

      <section class="article-footer">
        
      </section>

      <section class="article-navs">
        
<nav class="card-container card-article-nav">
  <div class="card-wrap">
    
      <div id="article-nav-newer" class="card-item">
        <article>
          
          <a class="card-link article-nav-link" href="/2020/03/20/66_python3%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90/"></a>
          <strong class="article-nav-caption">Newer</strong>
          <p class="article-nav-title">
            
              python3 自动生成配置
            
          </p>
        </article>
      </div>
    
    
      <div id="article-nav-older" class="card-item">
        <article>
          
          <a class="card-link article-nav-link" href="/2020/03/05/64_harbor2/"></a>
          <strong class="article-nav-caption">Older</strong>
          <p class="article-nav-title">
            
              harborV1.10.1 共享存储库预演测试
            
          </p>
        </article>
      </div>
    
  </div>
</nav>

      </section>
    </div>
  </article>
</div>

    <!-- footer container -->
<footer id="footer" class="footer">
  <div class="footer-container">
    
    <!-- <p>&copy; 2020 <a href="/" target="_blank">zhaodan</a></p> -->

    
      <p id="hitokoto"></p>
      <script src="https://v1.hitokoto.cn/?c=h&amp;encode=js&select=%23hitokoto" defer></script>
    

    

    <p>&copy; 2019 | zhaodan | 加油</p>
  </div>
</footer>

  </div>

  <div class="back-to-top-fixed">
    <svg class="icon icon-back-to-top" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M725.333333 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8l-213.333333-213.333333c-17.066667-17.066667-17.066667-42.666667 0-59.733333s42.666667-17.066667 59.733333 0l213.333333 213.333333c17.066667 17.066667 17.066667 42.666667 0 59.733333C746.666667 422.4 738.133333 426.666667 725.333333 426.666667z"></path>
  <path d="M298.666667 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8-17.066667-17.066667-17.066667-42.666667 0-59.733333l213.333333-213.333333c17.066667-17.066667 42.666667-17.066667 59.733333 0s17.066667 42.666667 0 59.733333l-213.333333 213.333333C320 422.4 311.466667 426.666667 298.666667 426.666667z"></path>
  <path d="M512 896c-25.6 0-42.666667-17.066667-42.666667-42.666667L469.333333 170.666667c0-25.6 17.066667-42.666667 42.666667-42.666667s42.666667 17.066667 42.666667 42.666667l0 682.666667C554.666667 878.933333 537.6 896 512 896z"></path>
</svg> 
  </div>

  
  
<!-- valine 评论 start -->
<script type="text/javascript" src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script type="text/javascript" src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script type="text/javascript">
  new Valine({
    el: "#valine_thread",
    appId: "atxC7OKi5cU4kOoIXIsuaiYS-gzGzoHsz",
    appKey: "tL6NhwpCUMckbjsucUjOnhVH",
    avatar: "mm",
    placeholder: "随便说点什么叭～",
    notify: true,
    visitor: true,
    pageSize: 10,
  });

</script>
<!-- valine 评论 end -->




  <!-- aplayer 音频 start -->
  
<link rel="stylesheet" href="/lib/APlayer.min.css">

  
<script src="/lib/APlayer.min.js"></script>

  <script type="text/javascript">
    const aplayer = document.querySelectorAll(".aplayer");
    aplayer && initaplayer(aplayer);
    function initaplayer(els) {
      let elsArr = Array.from(els);
      elsArr.forEach(el => {
        new APlayer({
          container: el,
          audio: { ...el.dataset },
          theme: "#b7daff",
          lrcType: 3,
          autoplay: false,
          loop: false,
          mutex: true,
        });
      });
    }
  </script>
  <!-- aplayer 音频 end -->
  

<!-- dplayer 视频 start -->

<link rel="stylesheet" href="/lib/DPlayer.min.css">


<script src="/lib/DPlayer.min.js"></script>

<script type="text/javascript">
  const dplayer = document.querySelectorAll(".dplayer");
  dplayer && initDPlayer(dplayer);
  function initDPlayer(els) {
    let elsArr = Array.from(els);
    elsArr.forEach(el => {
      let url = el.dataset.url;
      let cover = el.dataset.cover;
      new DPlayer({
        container: el,
        video: { url: url, pic: cover },
        theme: "#b7daff",
        autoplay: false,
        loop: false,
        mutex: true,
      });
    });
  }
</script>
<!-- dplayer 视频 end -->


<!-- waterfall 瀑布流 start -->

<script src="/lib/waterfall.min.js"></script>

<script type="text/javascript">

const waterfalls = document.querySelectorAll(".waterfall-container");

if (waterfalls && waterfalls.length > 0) {
  waterfalls.forEach((waterfall, index) => {
    let cls = "waterfall-container-" + index;
    waterfall.classList.add(cls);
    initWaterfall(cls, waterfall);
  });
}

function initWaterfall(selector, el) {
  const options = {};
  if (Object.keys(el.dataset).length > 0) {
    for (let k in el.dataset) {
      options[k] = el.dataset[k];
    }
  }
  waterfall(`.${selector}`, options);
}
</script>
<!-- waterfall 瀑布流 end -->


  <!-- zoom start -->
  
<script src="/lib/zoom.min.js"></script>

  <script type="text/javascript">
    document.querySelector(".article-content") && zoom(".article-content");
  </script>
  <!-- zoom end -->
  



  


  


  




<script src="/js/script.js"></script>

  
  <!-- 尾部用户自定义相关内容 -->

</body>
</html>