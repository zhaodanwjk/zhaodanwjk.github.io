<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>
        面对压迫、掠夺和孤单，我们的回答是生活
    </title>
    
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-reply replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            harborV1.10.1 基于复制策略同步测试
        </p>
        <hr>
    </div>
    <div class="post-content">
        <p>复制原理： harbor的复制案例是基于harbor的registry复制策略进行设置的<br>双主复制：其实就是复用主从同步实现两个harbor节点之间的双向同步<br>测试环境：使用docker部署启动，两个节点互为主从进行同步</p>
<p>测试过程：<br>CA认证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_6_centos ~]# mkdir &#x2F;data&#x2F;ssl</span><br><span class="line">[root@VM_0_6_centos ~]# cd &#x2F;data&#x2F;ssl&#x2F;</span><br><span class="line">[root@VM_0_6_centos ssl]# yum install openssl</span><br><span class="line">已加载插件：fastestmirror, langpacks</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">epel                                                                      | 5.3 kB  00:00:00</span><br><span class="line">extras                                                                    | 2.9 kB  00:00:00</span><br><span class="line">os                                                                        | 3.6 kB  00:00:00</span><br><span class="line">updates                                                                   | 2.9 kB  00:00:00</span><br><span class="line">(1&#x2F;2): epel&#x2F;7&#x2F;x86_64&#x2F;updateinfo                                           | 1.0 MB  00:00:00</span><br><span class="line">(2&#x2F;2): epel&#x2F;7&#x2F;x86_64&#x2F;primary_db                                           | 6.7 MB  00:00:00</span><br><span class="line">软件包 1:openssl-1.0.2k-19.el7.x86_64 已安装并且是最新版本</span><br><span class="line">无须任何处理</span><br><span class="line">[root@VM_0_6_centos ssl]# openssl req -newkey rsa:4096 -nodes -sha256 -keyout ca.key -x509 -days 365 -out ca.crt</span><br><span class="line">Generating a 4096 bit RSA private key</span><br><span class="line">.......++</span><br><span class="line">.................................................................................++</span><br><span class="line">writing new private key to &#39;ca.key&#39;</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &#39;.&#39;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:Shenzhen</span><br><span class="line">Locality Name (eg, city) [Default City]:Shenzhen</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:lumitest</span><br><span class="line">Organizational Unit Name (eg, section) []:lumitest</span><br><span class="line">Common Name (eg, your name or your server&#39;s hostname) []:www.lumitest.com</span><br><span class="line">Email Address []:</span><br><span class="line">[root@VM_0_6_centos ssl]# ls</span><br><span class="line">ca.crt  ca.key</span><br><span class="line">[root@VM_0_6_centos ssl]# openssl req -newkey rsa:4096 -nodes -sha256 -keyout www.lumitest.com.key -out www.lumitest.com.csr</span><br><span class="line">Generating a 4096 bit RSA private key</span><br><span class="line">.........++</span><br><span class="line">.....................................................++</span><br><span class="line">writing new private key to &#39;www.lumitest.com.key&#39;</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &#39;.&#39;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:Shenzhen</span><br><span class="line">Locality Name (eg, city) [Default City]:Shenzhen</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:lumitest</span><br><span class="line">Organizational Unit Name (eg, section) []:lumitest</span><br><span class="line">Common Name (eg, your name or your server&#39;s hostname) []:www.lumitest.com</span><br><span class="line">Email Address []:</span><br><span class="line"></span><br><span class="line">Please enter the following &#39;extra&#39; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:</span><br><span class="line">An optional company name []:</span><br><span class="line">[root@VM_0_6_centos ssl]# ls</span><br><span class="line">ca.crt  ca.key  www.lumitest.com.csr  www.lumitest.com.key</span><br><span class="line">[root@VM_0_6_centos ssl]# openssl x509 -req -days 365 -in www.lumitest.com.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out www.lumitest.com.crt</span><br><span class="line">Signature ok</span><br><span class="line">subject&#x3D;&#x2F;C&#x3D;CN&#x2F;ST&#x3D;Shenzhen&#x2F;L&#x3D;Shenzhen&#x2F;O&#x3D;lumitest&#x2F;OU&#x3D;lumitest&#x2F;CN&#x3D;www.lumitest.com</span><br><span class="line">Getting CA Private Key</span><br><span class="line">[root@VM_0_6_centos ssl]# ls</span><br><span class="line">ca.crt  ca.key  ca.srl  www.lumitest.com.crt  www.lumitest.com.csr  www.lumitest.com.key</span><br><span class="line">[root@VM_0_6_centos ssl]# ls &#x2F;etc&#x2F;pki&#x2F;ca-trust&#x2F;source&#x2F;anchors&#x2F;</span><br><span class="line">[root@VM_0_6_centos ssl]# cp www.lumitest.com.crt &#x2F;etc&#x2F;pki&#x2F;ca-trust&#x2F;source&#x2F;anchors&#x2F;</span><br><span class="line">[root@VM_0_6_centos ssl]# update</span><br><span class="line">update-alternatives   updatedb              update-pciids</span><br><span class="line">update-ca-trust       update-mime-database</span><br><span class="line">[root@VM_0_6_centos ssl]# update-ca-trust enable</span><br><span class="line">[root@VM_0_6_centos ssl]# update-ca-trust extract</span><br><span class="line"></span><br><span class="line">[root@VM_0_6_centos ssl]# mkdir &#x2F;etc&#x2F;ssl&#x2F;harbor</span><br><span class="line">[root@VM_0_6_centos ssl]# cp www.lumitest.com.crt www.lumitest.com.key &#x2F;etc&#x2F;ssl&#x2F;harbor&#x2F;</span><br><span class="line">[root@VM_0_6_centos ssl]# ls &#x2F;etc&#x2F;ssl&#x2F;harbor&#x2F;</span><br><span class="line">www.lumitest.com.crt  www.lumitest.com.key</span><br></pre></td></tr></table></figure>
<p>查看环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_6_centos ssl]# sestatus</span><br><span class="line">SELinux status:                 disabled</span><br><span class="line">[root@VM_0_6_centos ssl]# systemctl status firewalld</span><br><span class="line">● firewalld.service - firewalld - dynamic firewall daemon</span><br><span class="line">   Loaded: loaded (&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;firewalld.service; disabled; vendor preset: enabled)</span><br><span class="line">   Active: inactive (dead)</span><br><span class="line">     Docs: man:firewalld(1)</span><br><span class="line"></span><br><span class="line">[root@VM_0_6_centos harbor]# docker --version</span><br><span class="line">Docker version 1.13.1, build 4ef4b30&#x2F;1.13.1</span><br><span class="line">[root@VM_0_6_centos harbor]# yum remove docker \</span><br><span class="line">                   docker-client \</span><br><span class="line">                   docker-client-latest \</span><br><span class="line">                   docker-common \</span><br><span class="line">                   docker-latest \</span><br><span class="line">                   docker-latest-logrotate \</span><br><span class="line">                   docker-logrotate \</span><br><span class="line">                   docker-engine</span><br><span class="line">已加载插件：fastestmirror, langpacks</span><br><span class="line">参数 docker-client-latest 没有匹配</span><br><span class="line">参数 docker-latest 没有匹配</span><br><span class="line">参数 docker-latest-logrotate 没有匹配</span><br><span class="line">参数 docker-logrotate 没有匹配</span><br><span class="line">参数 docker-engine 没有匹配</span><br><span class="line">正在解决依赖关系</span><br><span class="line">--&gt; 正在检查事务</span><br><span class="line">---&gt; 软件包 docker.x86_64.2.1.13.1-108.git4ef4b30.el7.centos 将被 删除</span><br><span class="line">---&gt; 软件包 docker-client.x86_64.2.1.13.1-108.git4ef4b30.el7.centos 将被 删除</span><br><span class="line">---&gt; 软件包 docker-common.x86_64.2.1.13.1-108.git4ef4b30.el7.centos 将被 删除</span><br><span class="line">--&gt; 解决依赖关系完成</span><br><span class="line"></span><br><span class="line">依赖关系解决</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"> Package             架构         版本                                       源             大小</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">正在删除:</span><br><span class="line"> docker              x86_64       2:1.13.1-108.git4ef4b30.el7.centos         @extras        65 M</span><br><span class="line"> docker-client       x86_64       2:1.13.1-108.git4ef4b30.el7.centos         @extras        13 M</span><br><span class="line"> docker-common       x86_64       2:1.13.1-108.git4ef4b30.el7.centos         @extras       4.4 k</span><br><span class="line"></span><br><span class="line">事务概要</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">移除  3 软件包</span><br><span class="line"></span><br><span class="line">安装大小：77 M</span><br><span class="line">是否继续？[y&#x2F;N]：y</span><br><span class="line">Downloading packages:</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  正在删除    : 2:docker-1.13.1-108.git4ef4b30.el7.centos.x86_64                             1&#x2F;3</span><br><span class="line">警告：&#x2F;etc&#x2F;sysconfig&#x2F;docker-storage 已另存为 &#x2F;etc&#x2F;sysconfig&#x2F;docker-storage.rpmsave</span><br><span class="line">  正在删除    : 2:docker-client-1.13.1-108.git4ef4b30.el7.centos.x86_64                      2&#x2F;3</span><br><span class="line">  正在删除    : 2:docker-common-1.13.1-108.git4ef4b30.el7.centos.x86_64                      3&#x2F;3</span><br><span class="line">  验证中      : 2:docker-common-1.13.1-108.git4ef4b30.el7.centos.x86_64                      1&#x2F;3</span><br><span class="line">  验证中      : 2:docker-1.13.1-108.git4ef4b30.el7.centos.x86_64                             2&#x2F;3</span><br><span class="line">  验证中      : 2:docker-client-1.13.1-108.git4ef4b30.el7.centos.x86_64                      3&#x2F;3</span><br><span class="line"></span><br><span class="line">删除:</span><br><span class="line">  docker.x86_64 2:1.13.1-108.git4ef4b30.el7.centos</span><br><span class="line">  docker-client.x86_64 2:1.13.1-108.git4ef4b30.el7.centos</span><br><span class="line">  docker-common.x86_64 2:1.13.1-108.git4ef4b30.el7.centos</span><br><span class="line"></span><br><span class="line">完毕！</span><br><span class="line">[root@VM_0_6_centos harbor]# yum install -y yum-utils \</span><br><span class="line">   device-mapper-persistent-data \</span><br><span class="line">   lvm2</span><br><span class="line">已加载插件：fastestmirror, langpacks</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">软件包 yum-utils-1.1.31-52.el7.noarch 已安装并且是最新版本</span><br><span class="line">软件包 device-mapper-persistent-data-0.8.5-1.el7.x86_64 已安装并且是最新版本</span><br><span class="line">软件包 7:lvm2-2.02.185-2.el7_7.2.x86_64 已安装并且是最新版本</span><br><span class="line">无须任何处理</span><br><span class="line">[root@VM_0_6_centos harbor]# yum-config-manager \</span><br><span class="line">     --add-repo \</span><br><span class="line">     https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line">已加载插件：fastestmirror, langpacks</span><br><span class="line">adding repo from: https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line">grabbing file https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo to &#x2F;etc&#x2F;yum.repos.d&#x2F;docker-ce.repo</span><br><span class="line">repo saved to &#x2F;etc&#x2F;yum.repos.d&#x2F;docker-ce.repo</span><br><span class="line">[root@VM_0_6_centos harbor]# yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line">已加载插件：fastestmirror, langpacks</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">docker-ce-stable                                                          | 3.5 kB  00:00:00</span><br><span class="line">(1&#x2F;2): docker-ce-stable&#x2F;x86_64&#x2F;updateinfo                                 |   55 B  00:00:00</span><br><span class="line">(2&#x2F;2): docker-ce-stable&#x2F;x86_64&#x2F;primary_db                                 |  38 kB  00:00:00</span><br><span class="line">正在解决依赖关系</span><br><span class="line">--&gt; 正在检查事务</span><br><span class="line">---&gt; 软件包 containerd.io.x86_64.0.1.2.10-3.2.el7 将被 安装</span><br><span class="line">---&gt; 软件包 docker-ce.x86_64.3.19.03.6-3.el7 将被 安装</span><br><span class="line">---&gt; 软件包 docker-ce-cli.x86_64.1.19.03.6-3.el7 将被 安装</span><br><span class="line">--&gt; 解决依赖关系完成</span><br><span class="line"></span><br><span class="line">依赖关系解决</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"> Package                架构            版本                     源                         大小</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">正在安装:</span><br><span class="line"> containerd.io          x86_64          1.2.10-3.2.el7           docker-ce-stable           23 M</span><br><span class="line"> docker-ce              x86_64          3:19.03.6-3.el7          docker-ce-stable           24 M</span><br><span class="line"> docker-ce-cli          x86_64          1:19.03.6-3.el7          docker-ce-stable           40 M</span><br><span class="line"></span><br><span class="line">事务概要</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">安装  3 软件包</span><br><span class="line"></span><br><span class="line">总下载量：87 M</span><br><span class="line">安装大小：363 M</span><br><span class="line">Is this ok [y&#x2F;d&#x2F;N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">警告：&#x2F;var&#x2F;cache&#x2F;yum&#x2F;x86_64&#x2F;7&#x2F;docker-ce-stable&#x2F;packages&#x2F;containerd.io-1.2.10-3.2.el7.x86_64.rpm: 头V4 RSA&#x2F;SHA512 Signature, 密钥 ID 621e9f35: NOKEY</span><br><span class="line">containerd.io-1.2.10-3.2.el7.x86_64.rpm 的公钥尚未安装</span><br><span class="line">(1&#x2F;3): containerd.io-1.2.10-3.2.el7.x86_64.rpm                            |  23 MB  00:00:33</span><br><span class="line">(2&#x2F;3): docker-ce-cli-19.03.6-3.el7.x86_64.rpm                             |  40 MB  00:01:08</span><br><span class="line">docker-ce-19.03.6-3.el7.x86_64 FAILED                                           MB 418:34:55 ETA</span><br><span class="line">https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;7&#x2F;x86_64&#x2F;stable&#x2F;Packages&#x2F;docker-ce-19.03.6-3.el7.x86_64.rpm: [Errno 12] Timeout on https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;7&#x2F;x86_64&#x2F;stable&#x2F;Packages&#x2F;docker-ce-19.03.6-3.el7.x86_64.rpm: (28, &#39;Operation too slow. Less than 1000 bytes&#x2F;sec transferred the last 30 seconds&#39;)</span><br><span class="line">正在尝试其它镜像。</span><br><span class="line">docker-ce-19.03.6-3.el7.x86_64 FAILED                                          MB 2053:51:03 ETA</span><br><span class="line">https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;7&#x2F;x86_64&#x2F;stable&#x2F;Packages&#x2F;docker-ce-19.03.6-3.el7.x86_64.rpm: [Errno 12] Timeout on https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;7&#x2F;x86_64&#x2F;stable&#x2F;Packages&#x2F;docker-ce-19.03.6-3.el7.x86_64.rpm: (28, &#39;Operation too slow. Less than 1000 bytes&#x2F;sec transferred the last 30 seconds&#39;)</span><br><span class="line">正在尝试其它镜像。</span><br><span class="line">(3&#x2F;3): docker-ce-19.03.6-3.el7.x86_64.rpm                                 |  24 MB  00:00:22</span><br><span class="line">-------------------------------------------------------------------------------------------------</span><br><span class="line">总计                                                             358 kB&#x2F;s |  87 MB  00:04:09</span><br><span class="line">从 https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;gpg 检索密钥</span><br><span class="line">导入 GPG key 0x621E9F35:</span><br><span class="line"> 用户ID     : &quot;Docker Release (CE rpm) &lt;docker@docker.com&gt;&quot;</span><br><span class="line"> 指纹       : 060a 61c5 1b55 8a7f 742b 77aa c52f eb6b 621e 9f35</span><br><span class="line"> 来自       : https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;gpg</span><br><span class="line">是否继续？[y&#x2F;N]：y</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  正在安装    : containerd.io-1.2.10-3.2.el7.x86_64                                          1&#x2F;3</span><br><span class="line">  正在安装    : 1:docker-ce-cli-19.03.6-3.el7.x86_64                                         2&#x2F;3</span><br><span class="line">  正在安装    : 3:docker-ce-19.03.6-3.el7.x86_64                                             3&#x2F;3</span><br><span class="line">  验证中      : 3:docker-ce-19.03.6-3.el7.x86_64                                             1&#x2F;3</span><br><span class="line">  验证中      : 1:docker-ce-cli-19.03.6-3.el7.x86_64                                         2&#x2F;3</span><br><span class="line">  验证中      : containerd.io-1.2.10-3.2.el7.x86_64                                          3&#x2F;3</span><br><span class="line"></span><br><span class="line">已安装:</span><br><span class="line">  containerd.io.x86_64 0:1.2.10-3.2.el7             docker-ce.x86_64 3:19.03.6-3.el7</span><br><span class="line">  docker-ce-cli.x86_64 1:19.03.6-3.el7</span><br><span class="line"></span><br><span class="line">完毕！</span><br><span class="line">[root@VM_0_6_centos harbor]# systemctl start docker</span><br><span class="line">[root@VM_0_6_centos harbor]# docker --version</span><br><span class="line">Docker version 19.03.6, build 369ce74a3c</span><br></pre></td></tr></table></figure>
<p>配置harbor：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_6_centos harbor]# cat harbor.yml</span><br><span class="line"># Configuration file of Harbor</span><br><span class="line"></span><br><span class="line"># The IP address or hostname to access admin UI and registry service.</span><br><span class="line"># DO NOT use localhost or 127.0.0.1, because Harbor needs to be accessed by external clients.</span><br><span class="line">hostname: www.lumitest.com</span><br><span class="line"></span><br><span class="line"># http related config</span><br><span class="line">http:</span><br><span class="line">  # port for http, default is 80. If https enabled, this port will redirect to https port</span><br><span class="line">  port: 80</span><br><span class="line"></span><br><span class="line"># https related config</span><br><span class="line">https:</span><br><span class="line">  # https port for harbor, default is 443</span><br><span class="line">  port: 443</span><br><span class="line">  # The path of cert and key files for nginx</span><br><span class="line">  certificate: &#x2F;etc&#x2F;ssl&#x2F;harbor&#x2F;www.lumitest.com.crt</span><br><span class="line">  private_key: &#x2F;etc&#x2F;ssl&#x2F;harbor&#x2F;www.lumitest.com.key</span><br><span class="line"></span><br><span class="line"># Uncomment external_url if you want to enable external proxy</span><br><span class="line"># And when it enabled the hostname will no longer used</span><br><span class="line"># external_url: https:&#x2F;&#x2F;reg.mydomain.com:8433</span><br><span class="line"></span><br><span class="line"># The initial password of Harbor admin</span><br><span class="line"># It only works in first time to install harbor</span><br><span class="line"># Remember Change the admin password from UI after launching Harbor.</span><br><span class="line">harbor_admin_password: your_passwd</span><br><span class="line"></span><br><span class="line"># Harbor DB configuration</span><br><span class="line">database:</span><br><span class="line">  # The password for the root user of Harbor DB. Change this before any production use.</span><br><span class="line">  password: your_passwd</span><br><span class="line">  # The maximum number of connections in the idle connection pool. If it &lt;&#x3D;0, no idle connections are retained.</span><br><span class="line">  max_idle_conns: 50</span><br><span class="line">  # The maximum number of open connections to the database. If it &lt;&#x3D; 0, then there is no limit on the number of open connections.</span><br><span class="line">  # Note: the default number of connections is 100 for postgres.</span><br><span class="line">  max_open_conns: 100</span><br><span class="line"></span><br><span class="line"># The default data volume</span><br><span class="line">data_volume: &#x2F;data&#x2F;registry&#x2F;</span><br><span class="line"></span><br><span class="line"># Harbor Storage settings by default is using &#x2F;data dir on local filesystem</span><br><span class="line"># Uncomment storage_service setting If you want to using external storage</span><br><span class="line"># storage_service:</span><br><span class="line">#   # ca_bundle is the path to the custom root ca certificate, which will be injected into the truststore</span><br><span class="line">#   # of registry&#39;s and chart repository&#39;s containers.  This is usually needed when the user hosts a internal storage with self signed certificate.</span><br><span class="line">#   ca_bundle:</span><br><span class="line"></span><br><span class="line">#   # storage backend, default is filesystem, options include filesystem, azure, gcs, s3, swift and oss</span><br><span class="line">#   # for more info about this configuration please refer https:&#x2F;&#x2F;docs.docker.com&#x2F;registry&#x2F;configuration&#x2F;</span><br><span class="line">#   filesystem:</span><br><span class="line">#     maxthreads: 100</span><br><span class="line">#   # set disable to true when you want to disable registry redirect</span><br><span class="line">#   redirect:</span><br><span class="line">#     disabled: false</span><br><span class="line"></span><br><span class="line"># Clair configuration</span><br><span class="line">clair:</span><br><span class="line">  # The interval of clair updaters, the unit is hour, set to 0 to disable the updaters.</span><br><span class="line">  updaters_interval: 12</span><br><span class="line"></span><br><span class="line">jobservice:</span><br><span class="line">  # Maximum number of job workers in job service</span><br><span class="line">  max_job_workers: 10</span><br><span class="line"></span><br><span class="line">notification:</span><br><span class="line">  # Maximum retry count for webhook job</span><br><span class="line">  webhook_job_max_retry: 10</span><br><span class="line"></span><br><span class="line">chart:</span><br><span class="line">  # Change the value of absolute_url to enabled can enable absolute url in chart</span><br><span class="line">  absolute_url: disabled</span><br><span class="line"></span><br><span class="line"># Log configurations</span><br><span class="line">log:</span><br><span class="line">  # options are debug, info, warning, error, fatal</span><br><span class="line">  level: info</span><br><span class="line">  # configs for logs in local storage</span><br><span class="line">  local:</span><br><span class="line">    # Log files are rotated log_rotate_count times before being removed. If count is 0, old versions are removed rather than rotated.</span><br><span class="line">    rotate_count: 50</span><br><span class="line">    # Log files are rotated only if they grow bigger than log_rotate_size bytes. If size is followed by k, the size is assumed to be in kilobytes.</span><br><span class="line">    # If the M is used, the size is in megabytes, and if G is used, the size is in gigabytes. So size 100, size 100k, size 100M and size 100G</span><br><span class="line">    # are all valid.</span><br><span class="line">    rotate_size: 200M</span><br><span class="line">    # The directory on your host that store log</span><br><span class="line">    location: &#x2F;var&#x2F;log&#x2F;harbor</span><br><span class="line"></span><br><span class="line">  # Uncomment following lines to enable external syslog endpoint.</span><br><span class="line">  # external_endpoint:</span><br><span class="line">  #   # protocol used to transmit log to external endpoint, options is tcp or udp</span><br><span class="line">  #   protocol: tcp</span><br><span class="line">  #   # The host of external endpoint</span><br><span class="line">  #   host: localhost</span><br><span class="line">  #   # Port of external endpoint</span><br><span class="line">  #   port: 5140</span><br><span class="line"></span><br><span class="line">#This attribute is for migrator to detect the version of the .cfg file, DO NOT MODIFY!</span><br><span class="line">_version: 1.10.0</span><br><span class="line"></span><br><span class="line"># Uncomment external_database if using external database.</span><br><span class="line"># external_database:</span><br><span class="line">#   harbor:</span><br><span class="line">#     host: harbor_db_host</span><br><span class="line">#     port: harbor_db_port</span><br><span class="line">#     db_name: harbor_db_name</span><br><span class="line">#     username: harbor_db_username</span><br><span class="line">#     password: harbor_db_password</span><br><span class="line">#     ssl_mode: disable</span><br><span class="line">#     max_idle_conns: 2</span><br><span class="line">#     max_open_conns: 0</span><br><span class="line">#   clair:</span><br><span class="line">#     host: clair_db_host</span><br><span class="line">#     port: clair_db_port</span><br><span class="line">#     db_name: clair_db_name</span><br><span class="line">#     username: clair_db_username</span><br><span class="line">#     password: clair_db_password</span><br><span class="line">#     ssl_mode: disable</span><br><span class="line">#   notary_signer:</span><br><span class="line">#     host: notary_signer_db_host</span><br><span class="line">#     port: notary_signer_db_port</span><br><span class="line">#     db_name: notary_signer_db_name</span><br><span class="line">#     username: notary_signer_db_username</span><br><span class="line">#     password: notary_signer_db_password</span><br><span class="line">#     ssl_mode: disable</span><br><span class="line">#   notary_server:</span><br><span class="line">#     host: notary_server_db_host</span><br><span class="line">#     port: notary_server_db_port</span><br><span class="line">#     db_name: notary_server_db_name</span><br><span class="line">#     username: notary_server_db_username</span><br><span class="line">#     password: notary_server_db_password</span><br><span class="line">#     ssl_mode: disable</span><br><span class="line"></span><br><span class="line"># Uncomment external_redis if using external Redis server</span><br><span class="line"># external_redis:</span><br><span class="line">#   host: redis</span><br><span class="line">#   port: 6379</span><br><span class="line">#   password:</span><br><span class="line">#   # db_index 0 is for core, it&#39;s unchangeable</span><br><span class="line">#   registry_db_index: 1</span><br><span class="line">#   jobservice_db_index: 2</span><br><span class="line">#   chartmuseum_db_index: 3</span><br><span class="line">#   clair_db_index: 4</span><br><span class="line"></span><br><span class="line"># Uncomment uaa for trusting the certificate of uaa instance that is hosted via self-signed cert.</span><br><span class="line"># uaa:</span><br><span class="line">#   ca_file: &#x2F;path&#x2F;to&#x2F;ca</span><br><span class="line"></span><br><span class="line"># Global proxy</span><br><span class="line"># Config http proxy for components, e.g. http:&#x2F;&#x2F;my.proxy.com:3128</span><br><span class="line"># Components doesn&#39;t need to connect to each others via http proxy.</span><br><span class="line"># Remove component from &#96;components&#96; array if want disable proxy</span><br><span class="line"># for it. If you want use proxy for replication, MUST enable proxy</span><br><span class="line"># for core and jobservice, and set &#96;http_proxy&#96; and &#96;https_proxy&#96;.</span><br><span class="line"># Add domain to the &#96;no_proxy&#96; field, when you want disable proxy</span><br><span class="line"># for some special registry.</span><br><span class="line">proxy:</span><br><span class="line">  http_proxy:</span><br><span class="line">  https_proxy:</span><br><span class="line">  # no_proxy endpoints will appended to 127.0.0.1,localhost,.local,.internal,log,db,redis,nginx,core,portal,postgresql,jobservice,registry,registryctl,clair,chartmuseum,notary-server</span><br><span class="line">  no_proxy:</span><br><span class="line">  components:</span><br><span class="line">    - core</span><br><span class="line">    - jobservice</span><br><span class="line">    - clair</span><br></pre></td></tr></table></figure>
<p>启动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_6_centos harbor]# .&#x2F;install.sh --with-notary --with-clair</span><br><span class="line"></span><br><span class="line">[Step 0]: checking if docker is installed ...</span><br><span class="line"></span><br><span class="line">Note: docker version: 19.03.6</span><br><span class="line"></span><br><span class="line">[Step 1]: checking docker-compose is installed ...</span><br><span class="line"></span><br><span class="line">Note: docker-compose version: 1.25.4</span><br><span class="line"></span><br><span class="line">[Step 2]: loading Harbor images ...</span><br><span class="line">47a4bb1cfbc7: Loading layer  34.26MB&#x2F;34.26MB</span><br><span class="line">c2d9cf7a4eaf: Loading layer  9.056MB&#x2F;9.056MB</span><br><span class="line">32b7eca4f03e: Loading layer   9.71MB&#x2F;9.71MB</span><br><span class="line">5d104292391f: Loading layer   9.71MB&#x2F;9.71MB</span><br><span class="line">Loaded image: goharbor&#x2F;clair-adapter-photon:v1.0.1-v1.10.1</span><br><span class="line">0039915754c6: Loading layer  12.83MB&#x2F;12.83MB</span><br><span class="line">0a4ba5bc8bc2: Loading layer  49.37MB&#x2F;49.37MB</span><br><span class="line">Loaded image: goharbor&#x2F;harbor-jobservice:v1.10.1</span><br><span class="line">db95a8bece9e: Loading layer  78.32MB&#x2F;78.32MB</span><br><span class="line">f9aa9f9a3393: Loading layer  3.072kB&#x2F;3.072kB</span><br><span class="line">f0baa86a6ccd: Loading layer   59.9kB&#x2F;59.9kB</span><br><span class="line">2b8f0a44b78f: Loading layer  61.95kB&#x2F;61.95kB</span><br><span class="line">Loaded image: goharbor&#x2F;redis-photon:v1.10.1</span><br><span class="line">a9f6374f6301: Loading layer   9.05MB&#x2F;9.05MB</span><br><span class="line">b3c39a738965: Loading layer  6.239MB&#x2F;6.239MB</span><br><span class="line">dce1aa68054e: Loading layer  16.04MB&#x2F;16.04MB</span><br><span class="line">612aac9b538e: Loading layer  28.24MB&#x2F;28.24MB</span><br><span class="line">8612386fb841: Loading layer  22.02kB&#x2F;22.02kB</span><br><span class="line">53883649d694: Loading layer  50.52MB&#x2F;50.52MB</span><br><span class="line">Loaded image: goharbor&#x2F;notary-server-photon:v0.6.1-v1.10.1</span><br><span class="line">f3967aa0de5f: Loading layer  115.8MB&#x2F;115.8MB</span><br><span class="line">42fd590be962: Loading layer  12.14MB&#x2F;12.14MB</span><br><span class="line">096b03f3e32b: Loading layer  3.072kB&#x2F;3.072kB</span><br><span class="line">aa66bf3b8224: Loading layer  49.15kB&#x2F;49.15kB</span><br><span class="line">8e76391190c9: Loading layer  3.584kB&#x2F;3.584kB</span><br><span class="line">131573c722d5: Loading layer  13.02MB&#x2F;13.02MB</span><br><span class="line">Loaded image: goharbor&#x2F;clair-photon:v2.1.1-v1.10.1</span><br><span class="line">69e43242ff64: Loading layer  50.39MB&#x2F;50.39MB</span><br><span class="line">5a3a8e835993: Loading layer  3.584kB&#x2F;3.584kB</span><br><span class="line">4dff480c159c: Loading layer  3.072kB&#x2F;3.072kB</span><br><span class="line">2be454a39481: Loading layer   2.56kB&#x2F;2.56kB</span><br><span class="line">d6b4877d5c4e: Loading layer  3.072kB&#x2F;3.072kB</span><br><span class="line">609537197cce: Loading layer  3.584kB&#x2F;3.584kB</span><br><span class="line">b52d06cad304: Loading layer  12.29kB&#x2F;12.29kB</span><br><span class="line">Loaded image: goharbor&#x2F;harbor-log:v1.10.1</span><br><span class="line">badcf9296df7: Loading layer  9.056MB&#x2F;9.056MB</span><br><span class="line">8b17ed0102b2: Loading layer  3.584kB&#x2F;3.584kB</span><br><span class="line">4d1cd50b8d4f: Loading layer  3.072kB&#x2F;3.072kB</span><br><span class="line">491c41e50d6a: Loading layer  21.76MB&#x2F;21.76MB</span><br><span class="line">0101dc4148c7: Loading layer  22.59MB&#x2F;22.59MB</span><br><span class="line">Loaded image: goharbor&#x2F;registry-photon:v2.7.1-patch-2819-2553-v1.10.1</span><br><span class="line">77965b8f534b: Loading layer  14.61MB&#x2F;14.61MB</span><br><span class="line">940bf05c9601: Loading layer  28.24MB&#x2F;28.24MB</span><br><span class="line">7ca206eb72e3: Loading layer  22.02kB&#x2F;22.02kB</span><br><span class="line">9898774a5bad: Loading layer  49.09MB&#x2F;49.09MB</span><br><span class="line">Loaded image: goharbor&#x2F;notary-signer-photon:v0.6.1-v1.10.1</span><br><span class="line">86340c56281e: Loading layer  9.055MB&#x2F;9.055MB</span><br><span class="line">8ac45c34690f: Loading layer  42.31MB&#x2F;42.31MB</span><br><span class="line">4aa70453f992: Loading layer  3.072kB&#x2F;3.072kB</span><br><span class="line">6cbc6ab111b2: Loading layer  3.584kB&#x2F;3.584kB</span><br><span class="line">d6d7b70c18b5: Loading layer  43.14MB&#x2F;43.14MB</span><br><span class="line">Loaded image: goharbor&#x2F;chartmuseum-photon:v0.9.0-v1.10.1</span><br><span class="line">07efa003923d: Loading layer  9.056MB&#x2F;9.056MB</span><br><span class="line">96dd65c291de: Loading layer  3.584kB&#x2F;3.584kB</span><br><span class="line">802a1397679e: Loading layer  21.76MB&#x2F;21.76MB</span><br><span class="line">92c283f6895a: Loading layer  3.072kB&#x2F;3.072kB</span><br><span class="line">8b61b91240a6: Loading layer  8.662MB&#x2F;8.662MB</span><br><span class="line">1fd753477b6f: Loading layer  31.24MB&#x2F;31.24MB</span><br><span class="line">Loaded image: goharbor&#x2F;harbor-registryctl:v1.10.1</span><br><span class="line">48cda078e98d: Loading layer  10.89MB&#x2F;10.89MB</span><br><span class="line">Loaded image: goharbor&#x2F;nginx-photon:v1.10.1</span><br><span class="line">2c00d9af2c3f: Loading layer  34.31MB&#x2F;34.31MB</span><br><span class="line">0e4ae15c3d4e: Loading layer  339.9MB&#x2F;339.9MB</span><br><span class="line">27810c9ff1a9: Loading layer  135.2kB&#x2F;135.2kB</span><br><span class="line">Loaded image: goharbor&#x2F;harbor-migrator:v1.10.1</span><br><span class="line">93e0577272a9: Loading layer  34.24MB&#x2F;34.24MB</span><br><span class="line">fb3507ff707e: Loading layer  117.4MB&#x2F;117.4MB</span><br><span class="line">f59c6315bf8a: Loading layer  42.32MB&#x2F;42.32MB</span><br><span class="line">5c5501748347: Loading layer   2.56kB&#x2F;2.56kB</span><br><span class="line">3710d94e58dd: Loading layer  1.536kB&#x2F;1.536kB</span><br><span class="line">06e0f1585c01: Loading layer  166.4kB&#x2F;166.4kB</span><br><span class="line">bf5ac9b9c61c: Loading layer   3.01MB&#x2F;3.01MB</span><br><span class="line">Loaded image: goharbor&#x2F;prepare:v1.10.1</span><br><span class="line">9ea2dad46741: Loading layer  10.89MB&#x2F;10.89MB</span><br><span class="line">b280b9e7ca3b: Loading layer  7.696MB&#x2F;7.696MB</span><br><span class="line">a1ce7c1130ee: Loading layer  223.2kB&#x2F;223.2kB</span><br><span class="line">3b0492a7358b: Loading layer  195.1kB&#x2F;195.1kB</span><br><span class="line">c64d6e6c80dd: Loading layer  15.36kB&#x2F;15.36kB</span><br><span class="line">ace4e9064f06: Loading layer  3.584kB&#x2F;3.584kB</span><br><span class="line">Loaded image: goharbor&#x2F;harbor-portal:v1.10.1</span><br><span class="line">b74d8257d4e7: Loading layer  12.83MB&#x2F;12.83MB</span><br><span class="line">92f141040819: Loading layer   42.5MB&#x2F;42.5MB</span><br><span class="line">33c99383fac5: Loading layer  5.632kB&#x2F;5.632kB</span><br><span class="line">2bacc160d10f: Loading layer  40.45kB&#x2F;40.45kB</span><br><span class="line">f51bed904fbe: Loading layer   42.5MB&#x2F;42.5MB</span><br><span class="line">Loaded image: goharbor&#x2F;harbor-core:v1.10.1</span><br><span class="line">a2ffdaaa3434: Loading layer  63.56MB&#x2F;63.56MB</span><br><span class="line">5745ac9e0297: Loading layer  54.44MB&#x2F;54.44MB</span><br><span class="line">dc1d24cbb1d5: Loading layer  5.632kB&#x2F;5.632kB</span><br><span class="line">4280f2f98340: Loading layer  2.048kB&#x2F;2.048kB</span><br><span class="line">0f9279b20eec: Loading layer   2.56kB&#x2F;2.56kB</span><br><span class="line">8b9162d25131: Loading layer   2.56kB&#x2F;2.56kB</span><br><span class="line">50ad7481e5af: Loading layer   2.56kB&#x2F;2.56kB</span><br><span class="line">54b809bfb5ec: Loading layer  10.24kB&#x2F;10.24kB</span><br><span class="line">Loaded image: goharbor&#x2F;harbor-db:v1.10.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Step 3]: preparing environment ...</span><br><span class="line"></span><br><span class="line">[Step 4]: preparing harbor configs ...</span><br><span class="line">prepare base dir is set to &#x2F;data&#x2F;install&#x2F;harbor</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;log&#x2F;logrotate.conf</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;log&#x2F;rsyslog_docker.conf</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;nginx&#x2F;nginx.conf</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;core&#x2F;env</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;core&#x2F;app.conf</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;registry&#x2F;config.yml</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;registryctl&#x2F;env</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;db&#x2F;env</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;jobservice&#x2F;env</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;jobservice&#x2F;config.yml</span><br><span class="line">Generated and saved secret to file: &#x2F;secret&#x2F;keys&#x2F;secretkey</span><br><span class="line">Generated certificate, key file: &#x2F;secret&#x2F;core&#x2F;private_key.pem, cert file: &#x2F;secret&#x2F;registry&#x2F;root.crt</span><br><span class="line">Generated certificate, key file: &#x2F;tmp&#x2F;cert_tmp&#x2F;notary-signer-ca.key, cert file: &#x2F;tmp&#x2F;cert_tmp&#x2F;notary-signer-ca.crt</span><br><span class="line">Generated certificate, key file: &#x2F;tmp&#x2F;cert_tmp&#x2F;notary-signer.key, cert file: &#x2F;tmp&#x2F;cert_tmp&#x2F;notary-signer.crt</span><br><span class="line">Copying certs for notary signer</span><br><span class="line">Copying nginx configuration file for notary</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;nginx&#x2F;conf.d&#x2F;notary.upstream.conf</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;nginx&#x2F;conf.d&#x2F;notary.server.conf</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;notary&#x2F;server-config.postgres.json</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;notary&#x2F;server_env</span><br><span class="line">Generated and saved secret to file: &#x2F;secret&#x2F;keys&#x2F;defaultalias</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;notary&#x2F;signer_env</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;notary&#x2F;signer-config.postgres.json</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;clair&#x2F;postgres_env</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;clair&#x2F;config.yaml</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;clair&#x2F;clair_env</span><br><span class="line">Generated configuration file: &#x2F;config&#x2F;clair-adapter&#x2F;env</span><br><span class="line">Generated configuration file: &#x2F;compose_location&#x2F;docker-compose.yml</span><br><span class="line">Clean up the input dir</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Step 5]: starting Harbor ...</span><br><span class="line">Creating network &quot;harbor_harbor&quot; with the default driver</span><br><span class="line">Creating network &quot;harbor_harbor-clair&quot; with the default driver</span><br><span class="line">Creating network &quot;harbor_harbor-notary&quot; with the default driver</span><br><span class="line">Creating network &quot;harbor_notary-sig&quot; with the default driver</span><br><span class="line">Creating harbor-log ... done</span><br><span class="line">Creating registry      ... done</span><br><span class="line">Creating harbor-portal ... done</span><br><span class="line">Creating redis         ... done</span><br><span class="line">Creating harbor-db     ... done</span><br><span class="line">Creating registryctl   ... done</span><br><span class="line">Creating harbor-core   ... done</span><br><span class="line">Creating clair         ... done</span><br><span class="line">Creating notary-signer ... done</span><br><span class="line">Creating clair-adapter     ... done</span><br><span class="line">Creating notary-server     ... done</span><br><span class="line">Creating nginx             ... done</span><br><span class="line">Creating harbor-jobservice ... done</span><br><span class="line">✔ ----Harbor has been installed and started successfully.----</span><br><span class="line">[root@VM_0_6_centos harbor]# echo $?</span><br><span class="line">0</span><br></pre></td></tr></table></figure>
<p>配置hosts，登录测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_6_centos harbor]# vim &#x2F;etc&#x2F;hosts</span><br><span class="line">[root@VM_0_6_centos harbor]# docker login -uadmin -pyour_passwd www.lumitest.com</span><br><span class="line">WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span><br><span class="line">WARNING! Your password will be stored unencrypted in &#x2F;root&#x2F;.docker&#x2F;config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https:&#x2F;&#x2F;docs.docker.com&#x2F;engine&#x2F;reference&#x2F;commandline&#x2F;login&#x2F;#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line"></span><br><span class="line">[root@VM_0_6_centos harbor]# docker tag goharbor&#x2F;nginx-photon:v1.10.1 www.lumitest.com&#x2F;library&#x2F;replicate:v1</span><br><span class="line">[root@VM_0_6_centos harbor]# docker push www.lumitest.com&#x2F;library&#x2F;replicate:v1</span><br><span class="line">The push refers to repository [www.lumitest.com&#x2F;library&#x2F;replicate]</span><br><span class="line">48cda078e98d: Pushed</span><br><span class="line">47a4bb1cfbc7: Pushed</span><br><span class="line">v1: digest: sha256:8f900484be88c2f72699996ade92cbcbd84366f386396af0ac093430e6c2f7f2 size: 740</span><br></pre></td></tr></table></figure>
<p>证书拷贝到对应主机进行测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_6_centos harbor]# scp &#x2F;data&#x2F;ssl&#x2F;www.lumitest.com.crt root@172.16.0.8:&#x2F;etc&#x2F;pki&#x2F;ca-trust&#x2F;source&#x2F;anchors&#x2F;</span><br><span class="line">root@172.16.0.8&#39;s password:</span><br><span class="line">www.lumitest.com.crt                                                                100% 1931     6.5MB&#x2F;s   00:00</span><br><span class="line"></span><br><span class="line">[root@VM_0_8_centos ~]# update-ca-trust enable</span><br><span class="line">[root@VM_0_8_centos ~]# update-ca-trust extract</span><br><span class="line">[root@VM_0_8_centos ~]# sestatus</span><br><span class="line">SELinux status:                 disabled</span><br><span class="line">[root@VM_0_8_centos ~]# systemctl status firewalld</span><br><span class="line">● firewalld.service - firewalld - dynamic firewall daemon</span><br><span class="line">   Loaded: loaded (&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;firewalld.service; disabled; vendor preset: enabled)</span><br><span class="line">   Active: inactive (dead)</span><br><span class="line">     Docs: man:firewalld(1)</span><br><span class="line"></span><br><span class="line">[root@VM_0_8_centos ~]# docker login -uadmin -pyour_passwd www.lumitest.com</span><br><span class="line">WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span><br><span class="line">WARNING! Your password will be stored unencrypted in &#x2F;root&#x2F;.docker&#x2F;config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https:&#x2F;&#x2F;docs.docker.com&#x2F;engine&#x2F;reference&#x2F;commandline&#x2F;login&#x2F;#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>

<p>解决https认证问题<br><a href="http://www.voidcn.com/article/p-bsvymoes-bav.html" target="_blank" rel="noopener">http://www.voidcn.com/article/p-bsvymoes-bav.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 # cat &#x2F;etc&#x2F;pki&#x2F;ca-trust&#x2F;source&#x2F;anchors&#x2F;www.lumitest3.com.crt  &gt;&gt; &#x2F;etc&#x2F;pki&#x2F;tls&#x2F;certs&#x2F;ca-bundle.crt</span><br><span class="line">2 # systemctl restart docker</span><br></pre></td></tr></table></figure>
<p>自建证书不被信任，不能创建复制策略需关闭https ssl，改为http方式访问，创建仓库管理及复制管理策略进行同步实验<br><a href="https://postimg.cc/fSDmBcMg" target="_blank" rel="noopener"><img src="https://i.postimg.cc/XqyLNLm3/harbor-ms1.png" alt="harbor-ms1.png"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_6_centos harbor]# vim &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;docker.service</span><br><span class="line">[root@VM_0_6_centos harbor]# systemctl daemon-reload</span><br><span class="line">[root@VM_0_6_centos harbor]# systemctl restart docker</span><br><span class="line"></span><br><span class="line">[root@VM_0_6_centos harbor]# docker-compose stop</span><br><span class="line">[root@VM_0_6_centos harbor]# .&#x2F;prepare</span><br><span class="line">[root@VM_0_6_centos harbor]# .&#x2F;install.sh --with-clair</span><br><span class="line">[root@VM_0_6_centos harbor]# docker login 172.16.0.6</span><br><span class="line">Username: admin</span><br><span class="line">Password:</span><br><span class="line">WARNING! Your password will be stored unencrypted in &#x2F;root&#x2F;.docker&#x2F;config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https:&#x2F;&#x2F;docs.docker.com&#x2F;engine&#x2F;reference&#x2F;commandline&#x2F;login&#x2F;#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>
<p>分别在06、08上传不同的镜像，测试两边能否同步</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_6_centos harbor]# docker tag goharbor&#x2F;clair-adapter-photon:v1.0.1-v1.10.1 172.16.0.6&#x2F;library&#x2F;test:v2</span><br><span class="line">[root@VM_0_6_centos harbor]# docker push 172.16.0.6&#x2F;library&#x2F;test:v2</span><br><span class="line">The push refers to repository [172.16.0.6&#x2F;library&#x2F;test]</span><br><span class="line">5d104292391f: Pushed</span><br><span class="line">32b7eca4f03e: Pushed</span><br><span class="line">c2d9cf7a4eaf: Pushed</span><br><span class="line">47a4bb1cfbc7: Pushed</span><br><span class="line">v2: digest: sha256:7fddfab9a6568fed533870efda90e190eba9eb898832c4986dc0ce3d4aae6057 size: 1162</span><br><span class="line"></span><br><span class="line">[root@VM_0_8_centos ~]# docker tag goharbor&#x2F;harbor-log:v1.10.1 172.16.0.8&#x2F;library&#x2F;test8:v3</span><br><span class="line">[root@VM_0_8_centos ~]# docker push 172.16.0.8&#x2F;library&#x2F;test8:v3</span><br><span class="line">The push refers to repository [172.16.0.8&#x2F;library&#x2F;test8]</span><br><span class="line">b52d06cad304: Pushed</span><br><span class="line">609537197cce: Pushed</span><br><span class="line">d6b4877d5c4e: Pushed</span><br><span class="line">2be454a39481: Pushed</span><br><span class="line">4dff480c159c: Pushed</span><br><span class="line">5a3a8e835993: Pushed</span><br><span class="line">69e43242ff64: Pushed</span><br><span class="line">47a4bb1cfbc7: Pushed</span><br><span class="line">v3: digest: sha256:bb104098058f359c2cc25ffcb96810ebb69fc8d50e7290331e949e569c868c5d size: 1984</span><br></pre></td></tr></table></figure>
<p><a href="https://postimg.cc/qgT59WRW" target="_blank" rel="noopener"><img src="https://i.postimg.cc/ry02tkLy/harbor-ms2.png" alt="harbor-ms2.png"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_6_centos harbor]# docker tag goharbor&#x2F;harbor-portal:v1.10.1 172.16.0.6&#x2F;library&#x2F;test6:v3</span><br><span class="line">[root@VM_0_6_centos harbor]# docker push 172.16.0.6&#x2F;library&#x2F;test6:v3</span><br><span class="line">The push refers to repository [172.16.0.6&#x2F;library&#x2F;test6]</span><br><span class="line">ace4e9064f06: Pushed</span><br><span class="line">c64d6e6c80dd: Pushed</span><br><span class="line">3b0492a7358b: Pushed</span><br><span class="line">a1ce7c1130ee: Pushed</span><br><span class="line">b280b9e7ca3b: Pushed</span><br><span class="line">9ea2dad46741: Pushed</span><br><span class="line">47a4bb1cfbc7: Mounted from library&#x2F;test</span><br><span class="line">v3: digest: sha256:5c4481dd645d3c1e52b03e65a7fd4b030e7f8b040ed44a45f66908e24fe3f31a size: 1784</span><br><span class="line"></span><br><span class="line">[root@VM_0_8_centos ~]# docker tag goharbor&#x2F;registry-photon:v2.7.1-patch-2819-2553-v1.10.1 172.16.0.8&#x2F;library&#x2F;test08:v4</span><br><span class="line">[root@VM_0_8_centos ~]# docker push 172.16.0.8&#x2F;library&#x2F;test08:v4</span><br><span class="line">The push refers to repository [172.16.0.8&#x2F;library&#x2F;test08]</span><br><span class="line">0101dc4148c7: Pushed</span><br><span class="line">491c41e50d6a: Pushed</span><br><span class="line">4d1cd50b8d4f: Pushed</span><br><span class="line">8b17ed0102b2: Pushed</span><br><span class="line">badcf9296df7: Pushed</span><br><span class="line">47a4bb1cfbc7: Pushed</span><br><span class="line">v4: digest: sha256:3ee2e7dc7f93d9b922d382b8454fd017288d8eb8fdfdd022ade81e7c9f171723 size: 1576</span><br></pre></td></tr></table></figure>
<p><a href="https://postimg.cc/tZhF3SGx" target="_blank" rel="noopener"><img src="https://i.postimg.cc/tTcDHwr2/harbor-ms3.png" alt="harbor-ms3.png"></a></p>
<p>参考文档：<br><a href="https://www.cnblogs.com/breezey/p/9444231.html" target="_blank" rel="noopener">https://www.cnblogs.com/breezey/p/9444231.html</a><br><a href="https://www.cnblogs.com/wangzhangtao/p/12076816.html" target="_blank" rel="noopener">https://www.cnblogs.com/wangzhangtao/p/12076816.html</a><br>双主复制案例：<br><a href="https://www.dazhuanlan.com/2019/10/12/5da0faae2f6a5/" target="_blank" rel="noopener">https://www.dazhuanlan.com/2019/10/12/5da0faae2f6a5/</a><br><a href="https://segmentfault.com/a/1190000020144752" target="_blank" rel="noopener">https://segmentfault.com/a/1190000020144752</a><br>主从复制案例：<br><a href="http://www.imooc.com/article/270050" target="_blank" rel="noopener">http://www.imooc.com/article/270050</a><br><a href="https://www.cnblogs.com/cash-su/p/10103885.html" target="_blank" rel="noopener">https://www.cnblogs.com/cash-su/p/10103885.html</a></p>

    </div>

    
        <hr class="fhr">
        <div id="vcomments"></div>
    
</div>
    <div class="footer" id="footer">
    <p>Copyright © 2020 <a class="flink" href="https://hexo.io" target="_blank" rel="noopener">Hexo</a>-<a class="flink" href="https://github.com/sanjinhub/hexo-theme-geek" target="_blank" rel="noopener">Geek</a>.
        <label class="el-switch el-switch-green el-switch-sm" style="vertical-align: sub;">
            <input type="checkbox" name="switch" id="update_style">
            <span class="el-switch-style"></span>
        </label>
<!--         <script type="text/javascript">
        var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
        document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
        </script> -->
    </p>
</div>
<input type="hidden" id="web_style" value="black">
<input type="hidden" id="valine_appid" value="nmcd4VgylfORjevWz6UEoat3-9Nh9j0Va">
<input type="hidden" id="valine_appKey" value="wyWWI1qMf6w1mv1KpT1D0HeC">

<script src="/libs/jquery.min.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>

<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>

<script src="/js/js.js"></script>

<style type="text/css">
.v * {
    color: #698fca;
}

.v .vlist .vcard .vhead .vsys {
    color: #3a3e4a;
}

.v .vlist .vcard .vh .vmeta .vat {
    color: #638fd5;
}

.v .vlist .vcard .vhead .vnick {
    color: #6ba1ff;
}

.v a {
    color: #8696b1;
}

.v .vlist .vcard .vhead .vnick:hover {
    color: #669bfc;
}
</style>
</body>

</html>