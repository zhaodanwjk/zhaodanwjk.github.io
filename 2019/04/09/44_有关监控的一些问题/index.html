<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  
    <meta name="description" content="我连一秒都没有拥有过他，却感觉失去过他千万次">
  

  
    <meta name="keywords" content="best">
  

  
    <meta name="author" content="dandan">
  

  
    <meta name="copyright" content="zhaodan">
  

  

  <title>整理一些有关监控的一些事情 | 蛋蛋的笔记本</title>

  

  
    <link rel="icon" href="/favicon.ico">
  

  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
    <link href="https://cdn.bootcss.com/highlight.js/9.15.6/styles/monokai.min.css" rel="stylesheet">
  

  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>
<body>
  <div class="root-container">
    <!-- navbar -->
<nav class="navbar">
  <div class="navbar-content">
    <!-- logo -->
    <div class="navbar-logo">
      <a href="/">
        
          蛋蛋的笔记本
        
      </a>
    </div>
    <!-- link -->
    <div class="navbar-link">
      <div class="navbar-btn">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <ul class="navbar-list">
        
          <li class="navbar-list-item"><a href="/">HOME</a></li>
        
          <li class="navbar-list-item"><a href="/about">ABOUT</a></li>
        
          <li class="navbar-list-item"><a href="/tags">TAGS</a></li>
        
          <li class="navbar-list-item"><a href="/categories">CATEGORIES</a></li>
        
      </ul>
    </div>
  </div>
</nav>

    
<!-- header container -->
<header class="header-container post">

  
  

  
  

  
  

  
  

  
  
    <div class="header-content">
      <div class="post-image" style="background-image: url(https://qiniu.miiiku.xyz/src/images/banner.jpg)"></div>
      <div class="post-text">
        <div class="type-wrap">
          
        </div>
        <h1 class="title-wrap">整理一些有关监控的一些事情</h1>
        <h2 class="title-sub-wrap">
          <strong>dandan</strong>
          <span>发布于</span>
          
  <a href="javascript:;" class="article-date">
    <time datetime="2019-04-08T16:00:00.000Z" itemprop="datePublished">2019-04-09</time>
  </a>

        </h2>
      </div>
    </div>
  

  
  

  </header>

    <!-- 文章 -->

<!-- 文章内容 -->

<div class="body-container">
  <article class="content-container article-container">
    <div class="article-content">
      
      

      <section class="article-entry">
        <p>之前整理过现在线上使用的监控搭建过程，然鹅当时并没有深入理解，只是会照葫芦画瓢的搭建出来使用而已，近期线上出现了一些有关监控方面的问题才开始深入去了解</p>
<p>现在监控的架构是这样的;</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xl">collectd+graphite+grafana<br><br>graphite数据流向<br><span class="hljs-function"><span class="hljs-title">collectd</span>(收集数据可以配置使用哪些监控项) ----&gt;</span> <span class="hljs-function"><span class="hljs-title">carbon</span>-c-relay(过滤聚合转发) ----&gt;</span> <span class="hljs-function"><span class="hljs-title">go</span>-carbon(存储设置) ----&gt;</span> <span class="hljs-function"><span class="hljs-title">graphite</span>(whisper、uswgi、nginx) ----&gt;</span> granfana(展示)<br></code></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs routeros">问题一 carbon-c-relay ：<br><br>现在版本： carbon-c-relay-1.10-1.el6.x86_64.rpm<br><br>发现问题：程序崩溃<br><br>系统报错：<br><br>Feb  3 03:10:03 ip-10-33-3-12 kernel: [8905913.334999] carbon-c-relay[5707]: segfault at 2fce8<span class="hljs-built_in"> ip </span>000000000040dacf sp 00007f9ecaf5bcd0 <span class="hljs-builtin-name">error</span> 6 <span class="hljs-keyword">in</span> carbon-c-relay[400000+17000]<br>Feb  3 03:10:03 ip-10-33-3-12 kernel: [8905913.359297] carbon-c-relay[5708]: segfault at 2fcf0<span class="hljs-built_in"> ip </span>000000000040dacf sp 00007f9eca75acd0 <span class="hljs-builtin-name">error</span> 6 <span class="hljs-keyword">in</span> carbon-c-relay[400000+17000]<br>Feb  3 03:10:03 ip-10-33-3-12 kernel: [8905913.377903] carbon-c-relay[5709]: segfault at 2fcf8<span class="hljs-built_in"> ip </span>000000000040dacf sp 00007f9ec9f59cd0 <span class="hljs-builtin-name">error</span> 6 <span class="hljs-keyword">in</span> carbon-c-relay[400000+17000]<br>Feb  3 03:10:03 ip-10-33-3-12 kernel: [8905913.393349] carbon-c-relay[5710]: segfault at 2fd00<span class="hljs-built_in"> ip </span>000000000040dacf sp 00007f9ec9758cd0 <span class="hljs-builtin-name">error</span> 6 <span class="hljs-keyword">in</span> carbon-c-relay[400000+17000]<br><br> carbon-c-relay: *** <span class="hljs-builtin-name">Error</span> <span class="hljs-keyword">in</span> `/usr/bin/carbon-c-relay<span class="hljs-string">': corrupted double-linked list: 0x00007fbde00a4740 ***、</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">升级版本： carbon-c-relay-2.6-1.el6.x86_64.rpm</span><br></code></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">问题二 IOPS ：<br>问题原因： 服务器发送数据多，每当触发数据库操作，gamex就会发送一条数据到go-carbon，go-carbon一直处于读写状态，IO处理不过来，机器CPU正常，内存正常，但是load高，是因为写磁盘压力大<br><br>[<span class="hljs-symbol">root@</span>ip<span class="hljs-number">-10</span><span class="hljs-number">-33</span><span class="hljs-number">-3</span><span class="hljs-number">-152</span> whisper]# iostat -x <span class="hljs-number">2</span><br>Linux <span class="hljs-number">3.14</span><span class="hljs-number">.48</span><span class="hljs-number">-33.39</span>.amzn1.x86_64 (ip<span class="hljs-number">-10</span><span class="hljs-number">-33</span><span class="hljs-number">-3</span><span class="hljs-number">-152</span>)     <span class="hljs-number">03</span>/<span class="hljs-number">29</span>/<span class="hljs-number">2019</span>     _x86_64_    (<span class="hljs-number">4</span> CPU)<br><br>avg-cpu:  %user   %nice %system %iowait  %steal   %idle<br>           <span class="hljs-number">5.99</span>    <span class="hljs-number">0.00</span>    <span class="hljs-number">3.42</span>   <span class="hljs-number">28.05</span>    <span class="hljs-number">0.14</span>   <span class="hljs-number">62.41</span><br><br>Device:         rrqm/s   wrqm/s     r/s     w/s   rsec/s   wsec/s avgrq-sz avgqu-sz   await  svctm  %util<br>xvda              <span class="hljs-number">0.01</span>    <span class="hljs-number">56.77</span>    <span class="hljs-number">1.09</span>  <span class="hljs-number">144.61</span>    <span class="hljs-number">45.80</span>  <span class="hljs-number">1639.67</span>    <span class="hljs-number">11.57</span>     <span class="hljs-number">0.02</span>    <span class="hljs-number">0.14</span>   <span class="hljs-number">0.00</span>   <span class="hljs-number">0.07</span><br>xvdf              <span class="hljs-number">0.10</span>   <span class="hljs-number">653.70</span>   <span class="hljs-number">62.43</span> <span class="hljs-number">1524.71</span>  <span class="hljs-number">1069.56</span> <span class="hljs-number">17813.12</span>    <span class="hljs-number">11.90</span>     <span class="hljs-number">0.02</span>    <span class="hljs-number">0.01</span>   <span class="hljs-number">0.01</span>   <span class="hljs-number">2.37</span><br><br>avg-cpu:  %user   %nice %system %iowait  %steal   %idle<br>           <span class="hljs-number">6.97</span>    <span class="hljs-number">0.00</span>    <span class="hljs-number">2.19</span>   <span class="hljs-number">68.13</span>    <span class="hljs-number">0.39</span>   <span class="hljs-number">22.32</span><br><br>Device:         rrqm/s   wrqm/s     r/s     w/s   rsec/s   wsec/s avgrq-sz avgqu-sz   await  svctm  %util<br>xvda              <span class="hljs-number">0.00</span>     <span class="hljs-number">1.50</span>    <span class="hljs-number">0.50</span>    <span class="hljs-number">1.00</span>     <span class="hljs-number">8.00</span>    <span class="hljs-number">20.00</span>    <span class="hljs-number">18.67</span>     <span class="hljs-number">0.00</span>    <span class="hljs-number">0.00</span>   <span class="hljs-number">0.00</span>   <span class="hljs-number">0.00</span><br>xvdf              <span class="hljs-number">1.50</span>  <span class="hljs-number">2457.50</span>  <span class="hljs-number">595.00</span> <span class="hljs-number">3657.50</span>  <span class="hljs-number">8672.00</span> <span class="hljs-number">49832.00</span>    <span class="hljs-number">13.76</span>   <span class="hljs-number">133.24</span>   <span class="hljs-number">31.67</span>   <span class="hljs-number">0.24</span> <span class="hljs-number">100.00</span><br><br>发现问题： go-carbon进程奔溃<br><br>解决办法： 磁盘为<span class="hljs-number">700</span>G IOPS原来是<span class="hljs-number">3000</span>，调高了磁盘的IOPS为<span class="hljs-number">4000</span>，情况稍有缓解但并没有彻底解决，go-carbon进程每隔一段时间依旧会挂掉，等维护时更新了服务器,减少了一半的数据发送，磁盘的读下降，写升高。进程奔溃的问题才得以解决，但go-carbon占用系统的CPU依旧不低，大概在<span class="hljs-number">70</span>%<span class="hljs-number">-80</span>%左右。<br></code></pre></td></tr></table></figure>

<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vim">问题三 <span class="hljs-keyword">go</span>-carbon升级 <span class="hljs-built_in">and</span> 修改storage存储策略 :<br>问题原因： 监控部分数据只能保留<span class="hljs-number">7</span>天，当线上出现问题想要看近一个月的监控数据走向时很不方便<br>现在版本： <span class="hljs-keyword">go</span>-carbon-<span class="hljs-number">0.8</span>.<span class="hljs-number">1</span>-<span class="hljs-number">1</span>.el6.x86_64.rpm<br>升级版本： # rpm -Uvh <span class="hljs-keyword">go</span>-carbon-<span class="hljs-number">0.13</span>.<span class="hljs-number">0</span>-<span class="hljs-number">1</span>.x86_64.rpm （为了减小对监控业务使用的影响使用了 rpm -Uvh 直接升级）<br><span class="hljs-keyword">go</span>-carbon从 <span class="hljs-number">0.10</span>版本 以后就更改了很多配置文件的路径，具体版本更改了什么可以到github上查询 http<span class="hljs-variable">s:</span>//github.<span class="hljs-keyword">com</span>/lomik/<span class="hljs-keyword">go</span>-carbon/releases ，<span class="hljs-keyword">go</span>-carbon升级后发现磁盘的IOPS恢复了正常值，系统的load也降低了，<span class="hljs-keyword">go</span>-carbon占用系统CPU在<span class="hljs-number">30</span>%-<span class="hljs-number">40</span>%，可能作者对<span class="hljs-keyword">go</span>-carbon做了优化~~~~<br><br>再来说storage-schemas.<span class="hljs-keyword">conf</span>存储策略的问题，因为之前更改了好几次发现并没有生效，数据依旧只能保留<span class="hljs-number">7</span>天，因此还给<span class="hljs-keyword">go</span>-carbon提了一个issue...<br>其实是这样的，查了一些文档和别人使用的一些经验得知 ：<br>“ whisper是一个固定大小的数据库，所以当 storage-schemas.<span class="hljs-keyword">conf</span> 设定以后，一个metrics所占的磁盘空间就已经确定了。在系统运行的周期中只要根据 metrics 的增加进行适当扩容即可 ” “ storage-schemas.<span class="hljs-keyword">conf</span>修改以后对于已经在磁盘上进行记录的Metrics不会生效，需要删除数据重新写入或者进行数据迁移才行 ” “ 修改完毕，页面指标数据依然保持一天的量，当时想当然的以为需要重启graphite使配置生效。后来验证表明，调整这里的配置后，必须删除以前生成的wsp文件，生成新的wsp文件后方可生效。 ”<br><br>大概是因为监控搭建初期，其中部分数据设定值就是保留<span class="hljs-number">7</span>天，所以我将collectd下的数据备份后全部删除，使其发送过来的数据全是新生成的，期待能看到第<span class="hljs-number">8</span>天的数据。。。<br><br>还有有关我给<span class="hljs-keyword">go</span>-carbon提了一个issue，报错是一条“<span class="hljs-keyword">bad</span> message”,是因为carbon不支持存储 “nan”格式的数据<br></code></pre></td></tr></table></figure>
<p><a href="https://postimg.cc/PChgKZB2" target="_blank" rel="noopener"><img src="https://i.postimg.cc/ht7KD1MW/gocarbon.png" alt="gocarbon.png"></a></p>

      </section>

      <section class="article-footer">
        
      </section>

      <section class="article-navs">
        
<nav class="card-container card-article-nav">
  <div class="card-wrap">
    
      <div id="article-nav-newer" class="card-item">
        <article>
          
          <a class="card-link article-nav-link" href="/2019/04/19/45_jenkins%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/"></a>
          <strong class="article-nav-caption">Newer</strong>
          <p class="article-nav-title">
            
              有关jenkins的一些问题，基于role-based权限控制
            
          </p>
        </article>
      </div>
    
    
      <div id="article-nav-older" class="card-item">
        <article>
          
          <a class="card-link article-nav-link" href="/2019/02/26/43_mysql%E8%B0%83%E4%BC%98/"></a>
          <strong class="article-nav-caption">Older</strong>
          <p class="article-nav-title">
            
              记录一次mysql性能调优
            
          </p>
        </article>
      </div>
    
  </div>
</nav>

      </section>
    </div>
  </article>
</div>

    <!-- footer container -->
<footer id="footer" class="footer">
  <div class="footer-container">
    
    <div class="social-icons social-icons-footer">
      <a href="mailto:zhaodanwjk@163.com" target="_blank" rel="noopener noreferrer">
  <svg class="icon icon-email" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <path d="M490.338462 592.738462c11.815385 11.815385 29.538462 11.815385 41.353846 0l445.046154-413.538462c7.876923-15.753846 5.907692-41.353846-25.6-41.353846l-880.246154 1.969231c-23.630769 0-43.323077 21.661538-25.6 41.353846l445.046154 411.569231zM984.615385 340.676923c0-19.692308-23.630769-31.507692-39.384616-17.723077L596.676923 643.938462c-23.630769 21.661538-53.169231 33.476923-84.676923 33.476923s-61.046154-11.815385-84.676923-31.507693L80.738462 322.953846c-15.753846-13.784615-39.384615-3.938462-39.384616 17.723077C39.384615 334.769231 39.384615 787.692308 39.384615 787.692308c0 43.323077 35.446154 78.769231 78.769231 78.76923h787.692308c43.323077 0 78.769231-35.446154 78.769231-78.76923V340.676923z"></path>
  </svg>
</a><a href="https://www.instagram.com/hello_missdawn/" target="_blank" rel="noopener noreferrer">
  <svg class="icon icon-ins" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <path d="M512 0C372.906667 0 355.541333 0.64 300.928 3.072 246.4 5.632 209.28 14.208 176.64 26.88c-33.664 13.056-62.250667 30.592-90.709333 59.050667S39.893333 142.933333 26.88 176.64C14.208 209.28 5.589333 246.4 3.072 300.928 0.512 355.541333 0 372.906667 0 512s0.64 156.458667 3.072 211.072c2.56 54.485333 11.136 91.648 23.808 124.288a251.093333 251.093333 0 0 0 59.050667 90.709333A250.368 250.368 0 0 0 176.64 997.12c32.682667 12.629333 69.802667 21.290667 124.288 23.808C355.541333 1023.488 372.906667 1024 512 1024s156.458667-0.64 211.072-3.072c54.485333-2.56 91.648-11.178667 124.288-23.808a251.648 251.648 0 0 0 90.709333-59.050667 250.026667 250.026667 0 0 0 59.050667-90.709333c12.629333-32.64 21.290667-69.802667 23.808-124.288 2.56-54.613333 3.072-71.978667 3.072-211.072s-0.64-156.458667-3.072-211.072c-2.56-54.485333-11.178667-91.690667-23.808-124.288a251.306667 251.306667 0 0 0-59.050667-90.709333A249.472 249.472 0 0 0 847.36 26.88c-32.64-12.672-69.802667-21.290667-124.288-23.808C668.458667 0.512 651.093333 0 512 0z m0 92.16c136.661333 0 152.96 0.682667 206.933333 3.029333 49.92 2.346667 77.013333 10.624 95.018667 17.706667 23.978667 9.258667 40.96 20.352 58.965333 38.229333 17.877333 17.92 28.970667 34.944 38.229334 58.922667 6.997333 18.005333 15.36 45.098667 17.621333 95.018667 2.432 54.016 2.986667 70.229333 2.986667 206.933333s-0.64 152.96-3.157334 206.933333c-2.602667 49.92-10.922667 77.013333-17.962666 95.018667a162.56 162.56 0 0 1-38.357334 58.965333 159.744 159.744 0 0 1-58.88 38.229334c-17.92 6.997333-45.44 15.36-95.36 17.621333-54.357333 2.432-70.357333 2.986667-207.317333 2.986667-137.002667 0-153.002667-0.64-207.317333-3.157334-49.962667-2.602667-77.482667-10.922667-95.402667-17.962666a158.549333 158.549333 0 0 1-58.837333-38.357334 155.477333 155.477333 0 0 1-38.4-58.88c-7.04-17.92-15.317333-45.44-17.92-95.36-1.92-53.76-2.602667-70.357333-2.602667-206.677333 0-136.362667 0.682667-153.002667 2.602667-207.402667 2.602667-49.92 10.88-77.397333 17.92-95.317333 8.96-24.32 20.437333-40.96 38.4-58.922667 17.877333-17.877333 34.56-29.397333 58.837333-38.314666 17.92-7.082667 44.842667-15.402667 94.762667-17.962667 54.4-1.92 70.4-2.56 207.317333-2.56l1.92 1.28z m0 156.928a262.912 262.912 0 1 0 0 525.824 262.912 262.912 0 1 0 0-525.824zM512 682.666667c-94.293333 0-170.666667-76.373333-170.666667-170.666667s76.373333-170.666667 170.666667-170.666667 170.666667 76.373333 170.666667 170.666667-76.373333 170.666667-170.666667 170.666667z m334.762667-443.946667a61.482667 61.482667 0 0 1-122.88 0 61.44 61.44 0 0 1 122.88 0z"></path>
  </svg>
</a>
    </div>
     
    <p>&copy; 2020 <a href="/" target="_blank">dandan</a></p>

    
      <p id="hitokoto"></p>
      <script src="https://v1.hitokoto.cn/?c=c&amp;encode=js&select=%23hitokoto" defer></script>
    

    

    <p>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> Theme - <a href="https://github.com/miiiku/flex-block" target="_blank">flex-block</a></p>
  </div>
</footer>
  </div>

  <div class="back-to-top-fixed">
    <svg class="icon icon-back-to-top" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M725.333333 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8l-213.333333-213.333333c-17.066667-17.066667-17.066667-42.666667 0-59.733333s42.666667-17.066667 59.733333 0l213.333333 213.333333c17.066667 17.066667 17.066667 42.666667 0 59.733333C746.666667 422.4 738.133333 426.666667 725.333333 426.666667z"></path>
  <path d="M298.666667 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8-17.066667-17.066667-17.066667-42.666667 0-59.733333l213.333333-213.333333c17.066667-17.066667 42.666667-17.066667 59.733333 0s17.066667 42.666667 0 59.733333l-213.333333 213.333333C320 422.4 311.466667 426.666667 298.666667 426.666667z"></path>
  <path d="M512 896c-25.6 0-42.666667-17.066667-42.666667-42.666667L469.333333 170.666667c0-25.6 17.066667-42.666667 42.666667-42.666667s42.666667 17.066667 42.666667 42.666667l0 682.666667C554.666667 878.933333 537.6 896 512 896z"></path>
</svg> 
  </div>

  
  
<!-- valine 评论 start -->
<script type="text/javascript" src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script type="text/javascript" src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script type="text/javascript">
  new Valine({
    el: "#valine_thread",
    appId: "1x2m86DzLyVjjvrAd28PlcHP-9Nh9j0Va",
    appKey: "rOyvhDLkseoPCv9tY592cNVW",
    avatar: "mm",
    placeholder: "随便说点什么叭～",
    notify: true,
    visitor: true,
    pageSize: 10,
  });
</script>
<!-- valine 评论 end -->



  <!-- aplayer 音频 start -->
  
<link rel="stylesheet" href="/lib/APlayer.min.css">

  
<script src="/lib/APlayer.min.js"></script>

  <script type="text/javascript">
    const aplayer = document.querySelectorAll(".aplayer");
    aplayer && initaplayer(aplayer);
    function initaplayer(els) {
      let elsArr = Array.from(els);
      elsArr.forEach(el => {
        new APlayer({
          container: el,
          audio: { ...el.dataset },
          theme: "#b7daff",
          lrcType: 3,
          autoplay: false,
          loop: false,
          mutex: true,
        });
      });
    }
  </script>
  <!-- aplayer 音频 end -->
  

<!-- dplayer 视频 start -->

<link rel="stylesheet" href="/lib/DPlayer.min.css">


<script src="/lib/DPlayer.min.js"></script>

<script type="text/javascript">
  const dplayer = document.querySelectorAll(".dplayer");
  dplayer && initDPlayer(dplayer);
  function initDPlayer(els) {
    let elsArr = Array.from(els);
    elsArr.forEach(el => {
      let url = el.dataset.url;
      let cover = el.dataset.cover;
      new DPlayer({
        container: el,
        video: { url: url, pic: cover },
        theme: "#b7daff",
        autoplay: false,
        loop: false,
        mutex: true,
      });
    });
  }
</script>
<!-- dplayer 视频 end -->


<!-- waterfall 瀑布流 start -->

<script src="/lib/waterfall.min.js"></script>

<script type="text/javascript">

const waterfalls = document.querySelectorAll(".waterfall-container");

if (waterfalls && waterfalls.length > 0) {
  waterfalls.forEach((waterfall, index) => {
    let cls = "waterfall-container-" + index;
    waterfall.classList.add(cls);
    initWaterfall(cls, waterfall);
  });
}

function initWaterfall(selector, el) {
  const options = {};
  if (Object.keys(el.dataset).length > 0) {
    for (let k in el.dataset) {
      options[k] = el.dataset[k];
    }
  }
  waterfall(`.${selector}`, options);
}
</script>
<!-- waterfall 瀑布流 end -->


  <!-- zoom start -->
  
<script src="/lib/zoom.min.js"></script>

  <script type="text/javascript">
    document.querySelector(".article-content") && zoom(".article-content");
  </script>
  <!-- zoom end -->
  



  


  


  




<script src="/js/script.js"></script>

  
  <!-- 尾部用户自定义相关内容 -->

</body>
</html>